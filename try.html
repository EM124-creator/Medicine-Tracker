<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù†Ø¸Ø§Ù… Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ø£Ø¯ÙˆÙŠØ© Ø§Ù„Ù…ØªÙ‚Ø¯Ù… - Ù…ØªØ¹Ø¯Ø¯ Ø§Ù„Ø£Ø´Ø®Ø§Øµ</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            direction: rtl;
        }

        body.dark-mode {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
        }

        /* === ØµÙØ­Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ === */
        .login-page {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .login-container {
            background: white;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
            width: 100%;
            max-width: 400px;
        }

        body.dark-mode .login-container {
            background: #2c2c3e;
            color: #e0e0e0;
        }

        .login-title {
            text-align: center;
            margin-bottom: 30px;
            color: #0d47a1;
            font-size: 1.8rem;
        }

        body.dark-mode .login-title {
            color: #8fa3f5;
        }

        .login-form {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .login-form .form-group {
            margin-bottom: 0;
        }

        .login-form .form-input {
            width: 100%;
        }

        .login-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .login-actions .btn {
            flex: 1;
            justify-content: center;
        }

        /* === Ø¥Ø®ÙØ§Ø¡ Ø§Ù„ØµÙØ­Ø§Øª === */
        .page {
            display: none;
        }

        .page.active {
            display: block;
        }

        /* === ØµÙØ­Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© === */
        .user-page {
            display: block;
        }

        .container {
            max-width: 1800px;
            margin: 0 auto;
        }

        .header {
            background: white;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
            margin-bottom: 30px;
            text-align: center;
            position: relative;
        }

        body.dark-mode .header {
            background: #2c2c3e;
            color: #e0e0e0;
        }

        .user-controls {
            position: absolute;
            top: 20px;
            left: 20px;
            display: flex;
            gap: 10px;
        }

        .theme-toggle {
            background: #667eea;
            color: white;
            border: none;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 24px;
            transition: all 0.3s ease;
        }

        .theme-toggle:hover {
            transform: scale(1.1);
        }

        body.dark-mode .theme-toggle {
            background: #ffd700;
            color: #1a1a2e;
        }

        .logout-btn {
            background: #f44336;
            color: white;
            border: none;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 20px;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .logout-btn:hover {
            transform: scale(1.1);
        }

        h1 {
            font-size: 2.5rem;
            color: #0d47a1;
            margin-bottom: 10px;
        }

        body.dark-mode h1 {
            color: #8fa3f5;
        }

        .subtitle {
            color: #666;
            font-size: 1.1rem;
        }

        body.dark-mode .subtitle {
            color: #999;
        }

        .current-date {
            margin-top: 15px;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 12px;
            font-size: 1.2rem;
            font-weight: bold;
        }

        body.dark-mode .current-date {
            background: linear-gradient(135deg, #0f3460 0%, #16213e 100%);
        }

        .main-controls {
            background: white;
            padding: 25px;
            border-radius: 20px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: center;
            justify-content: center;
        }

        body.dark-mode .main-controls {
            background: #2c2c3e;
        }

        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-success {
            background: linear-gradient(135deg, #4CAF50 0%, #2e7d32 100%);
            color: white;
        }

        .btn-warning {
            background: linear-gradient(135deg, #ff9800 0%, #f57c00 100%);
            color: white;
        }

        .btn-info {
            background: linear-gradient(135deg, #2196F3 0%, #1565c0 100%);
            color: white;
        }

        .btn-danger {
            background: linear-gradient(135deg, #f44336 0%, #c62828 100%);
            color: white;
        }

        .btn-secondary {
            background: linear-gradient(135deg, #757575 0%, #424242 100%);
            color: white;
        }

        /* === ØµÙØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© (Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø¹Ø§Ø¯ÙŠ) === */
        .user-info {
            background: white;
            padding: 25px;
            border-radius: 20px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
            display: flex;
            align-items: center;
            gap: 20px;
            flex-wrap: wrap;
        }

        body.dark-mode .user-info {
            background: #2c2c3e;
        }

        .user-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 36px;
            color: white;
        }

        .user-details {
            flex: 1;
        }

        .user-name {
            font-size: 1.5rem;
            font-weight: bold;
            color: #0d47a1;
            margin-bottom: 5px;
        }

        body.dark-mode .user-name {
            color: #8fa3f5;
        }

        .user-age {
            color: #666;
            font-size: 1.1rem;
        }

        body.dark-mode .user-age {
            color: #999;
        }

        .delete-user-btn {
            margin-right: auto;
        }

        /* === ØµÙØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© (Ù„Ù€ Admin) === */
        .admin-page .user-list {
            background: white;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
        }

        body.dark-mode .admin-page .user-list {
            background: #2c2c3e;
        }

        .admin-user-card {
            background: #f9f9f9;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 15px;
            border-right: 5px solid #667eea;
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 15px;
        }

        body.dark-mode .admin-user-card {
            background: #1a1a2e;
        }

        .admin-user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .admin-user-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: white;
        }

        .admin-user-details h3 {
            color: #0d47a1;
            margin-bottom: 5px;
        }

        body.dark-mode .admin-user-details h3 {
            color: #8fa3f5;
        }

        .admin-user-stats {
            display: flex;
            gap: 15px;
            font-size: 14px;
            color: #666;
        }

        body.dark-mode .admin-user-stats {
            color: #999;
        }

        /* === Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£Ø¯ÙˆÙŠØ© === */
        .medications-list {
            background: white;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
        }

        body.dark-mode .medications-list {
            background: #2c2c3e;
            color: #e0e0e0;
        }

        .section-title {
            font-size: 1.8rem;
            margin-bottom: 20px;
            color: #0d47a1;
            display: flex;
            align-items: center;
            gap: 10px;
            padding-bottom: 15px;
            border-bottom: 3px solid #667eea;
        }

        body.dark-mode .section-title {
            color: #8fa3f5;
        }

        .medication-card {
            background: #f9f9f9;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 15px;
            border-right: 5px solid #667eea;
            transition: all 0.3s ease;
        }

        body.dark-mode .medication-card {
            background: #1a1a2e;
        }

        .medication-card:hover {
            transform: translateX(-5px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .medication-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .medication-name-wrapper {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .medication-name {
            font-size: 1.4rem;
            font-weight: bold;
            color: #0d47a1;
        }

        body.dark-mode .medication-name {
            color: #8fa3f5;
        }

        .medication-type {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
        }

        .type-pill {
            background: #e1f5fe;
            color: #0277bd;
        }

        .type-syrup {
            background: #f3e5f5;
            color: #6a1b9a;
        }

        .type-drops {
            background: #e8f5e9;
            color: #2e7d32;
        }

        .type-injection {
            background: #fff3e0;
            color: #e65100;
        }

        .type-cream {
            background: #fce4ec;
            color: #c2185b;
        }

        .type-inhaler {
            background: #e0f2f1;
            color: #00695c;
        }

        .type-capsule {
            background: #fff9c4;
            color: #f57f17;
        }

        .type-other {
            background: #f5f5f5;
            color: #616161;
        }

        .medication-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin-bottom: 15px;
        }

        .info-item {
            display: flex;
            align-items: center;
            gap: 8px;
            color: #666;
        }

        body.dark-mode .info-item {
            color: #999;
        }

        .info-item i {
            color: #667eea;
            width: 20px;
        }

        .medication-actions {
            display: flex;
            gap: 10px;
        }

        .medication-actions .btn {
            padding: 8px 15px;
            font-size: 14px;
        }

        /* === ØµÙØ­Ø© Ø§Ù„Ø¬Ø¯ÙˆÙ„ === */
        .schedule-page {
            display: none;
        }

        .schedule-page.active {
            display: block;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            text-align: center;
            transition: all 0.3s ease;
        }

        body.dark-mode .stat-card {
            background: #2c2c3e;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
        }

        .stat-card.primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .stat-card.success {
            background: linear-gradient(135deg, #4CAF50 0%, #2e7d32 100%);
            color: white;
        }

        .stat-card.danger {
            background: linear-gradient(135deg, #f44336 0%, #c62828 100%);
            color: white;
        }

        .stat-card.warning {
            background: linear-gradient(135deg, #ff9800 0%, #f57c00 100%);
            color: white;
        }

        .stat-number {
            font-size: 3rem;
            font-weight: 900;
            margin-bottom: 10px;
        }

        .stat-label {
            font-size: 1.1rem;
            font-weight: 600;
        }

        /* === Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø¬Ø±Ø¹Ø§Øª Ù…Ø¹ Ø§Ù„ÙÙˆØ§ØµÙ„ Ø¨ÙŠÙ† Ø§Ù„Ø£ÙŠØ§Ù… === */
        .schedule-table-container {
            background: white;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            overflow-x: auto;
            position: relative;
        }

        body.dark-mode .schedule-table-container {
            background: #2c2c3e;
        }

        /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ù„Ù„Ø·Ø¨Ø§Ø¹Ø© */
        @media print {
            .schedule-table-container {
                box-shadow: none;
                border: 1px solid #ddd;
            }

            .no-print {
                display: none !important;
            }

            body {
                background: white !important;
                padding: 10px !important;
            }

            .stat-card {
                break-inside: avoid;
            }

            table {
                break-inside: auto;
            }

            tr {
                break-inside: avoid;
                break-after: auto;
            }
        }

        .schedule-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            position: relative;
        }

        /* Ø®Ø· ÙØ§ØµÙ„ Ø¨ÙŠÙ† Ø§Ù„Ø£ÙŠØ§Ù… */
        .day-separator {
            border-bottom: 3px solid #667eea !important;
        }

        .day-separator-top {
            border-top: 3px solid #667eea !important;
        }

        /* ØªØ­Ø³ÙŠÙ† Ø±Ø£Ø³ Ø§Ù„Ø¬Ø¯ÙˆÙ„ */
        .schedule-table thead th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px;
            text-align: center;
            font-weight: 700;
            position: sticky;
            top: 0;
            z-index: 100;
            min-width: 150px;
        }

        body.dark-mode .schedule-table thead th {
            background: linear-gradient(135deg, #0f3460 0%, #16213e 100%);
        }

        /* Ø®Ù„Ø§ÙŠØ§ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª */
        .schedule-table td {
            padding: 12px;
            border: 1px solid #e0e0e0;
            text-align: center;
            vertical-align: middle;
            transition: all 0.3s ease;
            min-width: 180px;
            background: #f9f9f9;
            position: relative;
        }

        body.dark-mode .schedule-table td {
            border-color: #424242;
            background: #1a1a2e;
        }

        /* Ø®Ù„Ø§ÙŠØ§ Ø§Ù„ØªØ§Ø±ÙŠØ® - ØªØ¸Ù„ Ø«Ø§Ø¨ØªØ© Ø¹Ù†Ø¯ Ø§Ù„ØªÙ…Ø±ÙŠØ± Ù„Ù„ÙŠÙ…ÙŠÙ† */
        .date-header {
            position: sticky;
            left: 0;
            z-index: 50;
            background: #e3f2fd;
            font-weight: 700;
            color: #0d47a1;
            min-width: 180px;
        }

        body.dark-mode .date-header {
            background: #1e3a5f;
            color: #8fa3f5;
        }

        /* Ø®Ù„Ø§ÙŠØ§ Ø§Ù„Ø¬Ø±Ø¹Ø§Øª */
        .dose-cell {
            min-height: 100px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 10px;
            border-radius: 8px;
            margin: 2px;
        }

        .dose-cell.taken {
            background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%);
        }

        body.dark-mode .dose-cell.taken {
            background: linear-gradient(135deg, #2e7d32 0%, #1b5e20 100%);
        }

        .dose-cell.missed {
            background: linear-gradient(135deg, #ffebee 0%, #ffcdd2 100%);
        }

        body.dark-mode .dose-cell.missed {
            background: linear-gradient(135deg, #c62828 0%, #b71c1c 100%);
        }

        .dose-cell.upcoming {
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
        }

        body.dark-mode .dose-cell.upcoming {
            background: linear-gradient(135deg, #0d47a1 0%, #1565c0 100%);
        }

        .dose-checkbox {
            width: 24px;
            height: 24px;
            cursor: pointer;
            accent-color: #4CAF50;
        }

        .dose-info {
            margin-top: 8px;
            font-size: 12px;
            color: #666;
            text-align: center;
        }

        body.dark-mode .dose-info {
            color: #999;
        }

        .dose-time {
            font-weight: 600;
            margin-bottom: 4px;
            font-size: 14px;
        }

        .food-relation {
            font-size: 11px;
            color: #ff9800;
            margin-bottom: 4px;
        }

        .dose-actions {
            display: flex;
            gap: 5px;
            margin-top: 8px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .dose-actions button {
            padding: 3px 8px;
            font-size: 11px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .edit-time-btn {
            background: #2196F3;
            color: white;
        }

        .add-note-btn {
            background: #ff9800;
            color: white;
        }

        .note-indicator {
            position: absolute;
            top: 5px;
            left: 5px;
            color: #ff9800;
            font-size: 12px;
        }

        /* ØªØ£Ø«ÙŠØ± hover */
        .schedule-table tr:hover td {
            background: #f0f7ff;
        }

        body.dark-mode .schedule-table tr:hover td {
            background: #1e3a5f;
        }

        .schedule-table tr:hover .date-header {
            background: #bbdefb;
        }

        body.dark-mode .schedule-table tr:hover .date-header {
            background: #0d47a1;
        }

        /* === Ø§Ù„Ù†ÙˆØ§ÙØ° Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© === */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            padding: 40px;
            border-radius: 20px;
            max-width: 700px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        }

        body.dark-mode .modal-content {
            background: #2c2c3e;
            color: #e0e0e0;
        }

        .modal-header {
            font-size: 2rem;
            margin-bottom: 30px;
            color: #0d47a1;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        body.dark-mode .modal-header {
            color: #8fa3f5;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #0d47a1;
        }

        body.dark-mode .form-label {
            color: #8fa3f5;
        }

        .form-input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        body.dark-mode .form-input {
            background: #1a1a2e;
            color: #e0e0e0;
            border-color: #424242;
        }

        .form-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.2);
        }

        textarea.form-input {
            min-height: 100px;
            resize: vertical;
        }

        .modal-actions {
            display: flex;
            gap: 15px;
            margin-top: 30px;
        }

        .modal-actions .btn {
            flex: 1;
            justify-content: center;
        }

        /* === Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª === */
        .notification {
            position: fixed;
            top: 30px;
            left: 30px;
            padding: 20px 30px;
            background: #4CAF50;
            color: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            z-index: 3000;
            display: flex;
            align-items: center;
            gap: 15px;
            font-size: 1.1rem;
            font-weight: 600;
            transform: translateX(-150%);
            transition: transform 0.5s ease;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.error {
            background: #f44336;
        }

        .notification i {
            font-size: 1.5rem;
        }

        /* === Ø§Ù„Ø­Ø§Ù„Ø§Øª Ø§Ù„ÙØ§Ø±ØºØ© === */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #999;
        }

        .empty-state i {
            font-size: 4rem;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        body.dark-mode .empty-state {
            color: #999;
        }

        /* === Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ…Ø±ÙŠØ± === */
        ::-webkit-scrollbar {
            width: 10px;
            height: 10px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }

        body.dark-mode ::-webkit-scrollbar-track {
            background: #1a1a2e;
        }

        ::-webkit-scrollbar-thumb {
            background: #667eea;
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #764ba2;
        }

        /* === ØªØ­Ø³ÙŠÙ†Ø§Øª Ù„Ù„Ø¬ÙˆØ§Ù„ === */
        @media (max-width: 768px) {
            .login-container {
                padding: 20px;
            }

            h1 {
                font-size: 1.8rem;
            }

            .header {
                padding: 20px;
            }

            .main-controls {
                flex-direction: column;
                padding: 20px;
            }

            .btn {
                width: 100%;
            }

            .user-info {
                flex-direction: column;
                text-align: center;
                padding: 20px;
            }

            .delete-user-btn {
                margin: 10px auto 0;
            }

            .medication-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }

            .medication-actions {
                width: 100%;
                justify-content: center;
            }

            .schedule-table-container {
                padding: 15px;
            }

            .schedule-table {
                font-size: 12px;
            }

            .schedule-table th,
            .schedule-table td {
                padding: 8px;
                min-width: 120px;
            }

            .dose-cell {
                min-height: 80px;
                padding: 5px;
            }

            .dose-actions button {
                padding: 2px 5px;
                font-size: 10px;
            }

            .modal-content {
                padding: 20px;
            }
        }

        /* === ØªØ­Ø³ÙŠÙ†Ø§Øª Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© === */
        @media print {
            body {
                background: white !important;
                padding: 0 !important;
                color: black !important;
            }

            .no-print {
                display: none !important;
            }

            .login-page,
            .user-controls,
            .main-controls,
            .medication-actions .btn:not(.print-btn),
            .modal,
            .notification {
                display: none !important;
            }

            .container {
                max-width: 100% !important;
                margin: 0 !important;
                padding: 0 !important;
            }

            .header,
            .medications-list,
            .schedule-table-container {
                box-shadow: none !important;
                border: 1px solid #ddd !important;
                margin: 10px 0 !important;
                padding: 15px !important;
                border-radius: 0 !important;
                page-break-inside: avoid;
            }

            .schedule-table {
                border: 1px solid #000 !important;
            }

            .schedule-table th,
            .schedule-table td {
                border: 1px solid #000 !important;
                color: black !important;
                background: white !important;
            }

            .stat-card {
                box-shadow: none !important;
                border: 1px solid #ddd !important;
                margin: 5px !important;
                break-inside: avoid;
            }

            .btn {
                display: none !important;
            }

            .dose-actions {
                display: none !important;
            }

            .theme-toggle,
            .logout-btn {
                display: none !important;
            }
        }

        /* === Ø¥Ø¶Ø§ÙØ© Ø£Ù†Ù…Ø§Ø· Ù†Ø¸Ø§Ù… Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª === */
        .notifications-panel {
            background: white;
            padding: 25px;
            border-radius: 20px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
        }

        body.dark-mode .notifications-panel {
            background: #2c2c3e;
            color: #e0e0e0;
        }

        .notification-settings {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .setting-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: #f9f9f9;
            border-radius: 12px;
            border-right: 4px solid #667eea;
        }

        body.dark-mode .setting-item {
            background: #1a1a2e;
        }

        .setting-info {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .setting-title {
            font-weight: 600;
            color: #0d47a1;
        }

        body.dark-mode .setting-title {
            color: #8fa3f5;
        }

        .setting-desc {
            font-size: 0.9rem;
            color: #666;
        }

        body.dark-mode .setting-desc {
            color: #999;
        }

        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 30px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 34px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 22px;
            width: 22px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background: linear-gradient(135deg, #4CAF50 0%, #2e7d32 100%);
        }

        input:checked + .slider:before {
            transform: translateX(30px);
        }

        .test-notification-btn {
            margin-top: 10px;
            background: #9c27b0;
            color: white;
        }

        .test-notification-btn:hover {
            background: #7b1fa2;
        }

        .floating-notifications-btn {
            position: fixed;
            bottom: 30px;
            left: 30px;
            z-index: 1000;
            background: linear-gradient(135deg, #ff9800 0%, #f57c00 100%);
            color: white;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            border: none;
            cursor: pointer;
            font-size: 24px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .floating-notifications-btn:hover {
            transform: scale(1.1);
        }

        .floating-notifications-btn.active {
            background: linear-gradient(135deg, #4CAF50 0%, #2e7d32 100%);
        }

        .floating-notifications-btn.muted {
            background: linear-gradient(135deg, #f44336 0%, #c62828 100%);
        }

        .medication-alert-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.8);
            z-index: 9999;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s ease;
        }

        .medication-alert {
            background: white;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
            max-width: 500px;
            width: 90%;
            text-align: center;
            animation: slideUp 0.5s ease;
            border: 5px solid #ff9800;
        }

        body.dark-mode .medication-alert {
            background: #2c2c3e;
            color: #e0e0e0;
        }

        .alert-header {
            margin-bottom: 20px;
        }

        .alert-header h3 {
            color: #ff9800;
            font-size: 1.8rem;
            margin: 10px 0;
        }

        .alert-body {
            background: #f9f9f9;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 25px;
            text-align: right;
        }

        body.dark-mode .alert-body {
            background: #1a1a2e;
        }

        .alert-body p {
            margin: 10px 0;
            font-size: 1.1rem;
        }

        .alert-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .alert-actions .btn {
            flex: 1;
            min-width: 150px;
            justify-content: center;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideUp {
            from { transform: translateY(50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .notification-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: #f44336;
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }
    </style>
</head>

<body>
    <!-- ØµÙØ­Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ -->
    <div class="page login-page active" id="loginPage">
        <div class="login-container">
            <h1 class="login-title"><i class="fas fa-user-md"></i> Ù†Ø¸Ø§Ù… Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ø£Ø¯ÙˆÙŠØ©</h1>
            
            <div class="login-form">
                <div class="form-group">
                    <label class="form-label">Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</label>
                    <input type="text" class="form-input" id="loginUsername" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…">
                </div>
                
                <div class="form-group">
                    <label class="form-label">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
                    <input type="password" class="form-input" id="loginPassword" placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
                </div>
                
                <div class="login-actions">
                    <button class="btn btn-primary" onclick="login()">
                        <i class="fas fa-sign-in-alt"></i> ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
                    </button>
                    <button class="btn btn-secondary" onclick="document.getElementById('registerModal').classList.add('active')">
                        <i class="fas fa-user-plus"></i> ØªØ³Ø¬ÙŠÙ„ Ø¬Ø¯ÙŠØ¯
                    </button>
                </div>
                
                <div style="text-align: center; margin-top: 20px; color: #666;">
                    <p><strong>Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ù„ØªØ¬Ø±Ø¨Ø©:</strong></p>
                    <p>Ø§Ù„Ù…Ø¯ÙŠØ±: admin / admin123</p>
                    <p>Ù…Ø³ØªØ®Ø¯Ù… ØªØ¬Ø±ÙŠØ¨ÙŠ: test / test123</p>
                </div>
            </div>
        </div>
    </div>

    <!-- ØµÙØ­Ø© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù†Ø¸Ø§Ù… (Ù„Ù„Ù…Ø¯ÙŠØ±) -->
    <div class="page admin-page" id="adminPage">
        <div class="container">
            <div class="header">
                <div class="user-controls">
                    <button class="theme-toggle" onclick="toggleTheme()">ğŸŒ™</button>
                    <button class="logout-btn" onclick="logout()">
                        <i class="fas fa-sign-out-alt"></i>
                    </button>
                </div>
                <h1><i class="fas fa-user-shield"></i> Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ù…Ø¯ÙŠØ±</h1>
                <p class="subtitle">Ø¥Ø¯Ø§Ø±Ø© Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</p>
                <div class="current-date" id="currentDate"></div>
            </div>

            <div class="user-list" id="adminUserList">
                <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¨Ø§Ù„ÙƒÙˆØ¯ -->
            </div>
        </div>
    </div>

    <!-- ØµÙØ­Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© -->
    <div class="page user-page" id="userPage">
        <div class="container">
            <div class="header">
                <div class="user-controls">
                    <button class="theme-toggle" onclick="toggleTheme()">ğŸŒ™</button>
                    <button class="logout-btn" onclick="logout()">
                        <i class="fas fa-sign-out-alt"></i>
                    </button>
                </div>
                <h1><i class="fas fa-pills"></i> Ù†Ø¸Ø§Ù… Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ø£Ø¯ÙˆÙŠØ© Ø§Ù„Ù…ØªÙ‚Ø¯Ù…</h1>
                <p class="subtitle">Ø¥Ø¯Ø§Ø±Ø© Ø£Ø¯ÙˆÙŠØªÙƒ ÙˆÙ…ØªØ§Ø¨Ø¹Ø© Ø¬Ø±Ø¹Ø§ØªÙƒ Ø¨Ø¯Ù‚Ø©</p>
                <div class="current-date" id="currentDate"></div>
            </div>

            <div class="user-info" id="userInfo">
                <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¨Ø§Ù„ÙƒÙˆØ¯ -->
            </div>

            <!-- Ù„ÙˆØ­Ø© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª -->
            <div class="notifications-panel" id="notificationsPanel">
                <h2 class="section-title">
                    <i class="fas fa-bell"></i> Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª ÙˆØ§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª
                </h2>
                
                <div class="notification-settings">
                    <div class="setting-item">
                        <div class="setting-info">
                            <span class="setting-title">Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Push</span>
                            <span class="setting-desc">Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø¹Ù„Ù‰ Ø´Ø§Ø´Ø© Ù‡Ø§ØªÙÙƒ Ø­ØªÙ‰ Ø¹Ù†Ø¯ Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù…ÙˆÙ‚Ø¹</span>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="pushNotificationsToggle" onclick="togglePushNotifications()">
                            <span class="slider"></span>
                        </label>
                    </div>
                    
                    <div class="setting-item">
                        <div class="setting-info">
                            <span class="setting-title">Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø§Ù„ØµÙˆØªÙŠØ©</span>
                            <span class="setting-desc">ØªØ´ØºÙŠÙ„ ØµÙˆØª Ø¹Ù†Ø¯ ÙˆÙ‚Øª Ø§Ù„Ø¯ÙˆØ§Ø¡</span>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="soundNotificationsToggle" checked onclick="toggleSoundNotifications()">
                            <span class="slider"></span>
                        </label>
                    </div>
                    
                    <div class="setting-item">
                        <div class="setting-info">
                            <span class="setting-title">Ø§Ù„ØªÙƒØ±Ø§Ø± Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ</span>
                            <span class="setting-desc">ØªÙƒØ±Ø§Ø± Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± ÙƒÙ„ 10 Ø¯Ù‚Ø§Ø¦Ù‚ Ø­ØªÙ‰ Ø£Ø®Ø° Ø§Ù„Ø¯ÙˆØ§Ø¡</span>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="autoRepeatToggle" checked onclick="toggleAutoRepeat()">
                            <span class="slider"></span>
                        </label>
                    </div>
                    
                    <div class="setting-item">
                        <div class="setting-info">
                            <span class="setting-title">ÙˆØ¶Ø¹ Ø§Ù„ØµØ§Ù…Øª</span>
                            <span class="setting-desc">ÙƒØªÙ… Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ù„Ù…Ø¯Ø© 10 Ø¯Ù‚Ø§Ø¦Ù‚ Ø¹Ù†Ø¯ Ø§Ù„Ø·Ù„Ø¨</span>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="muteToggle" onclick="toggleMute()">
                            <span class="slider"></span>
                        </label>
                    </div>
                    
                    <button class="btn test-notification-btn" onclick="testNotification()">
                        <i class="fas fa-bell"></i> Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
                    </button>
                </div>
            </div>

            <div class="main-controls">
                <button class="btn btn-primary" onclick="openAddMedicationModal()">
                    <i class="fas fa-plus"></i> Ø¥Ø¶Ø§ÙØ© Ø¯ÙˆØ§Ø¡ Ø¬Ø¯ÙŠØ¯
                </button>
                <button class="btn btn-info" onclick="openSchedulePage()">
                    <i class="fas fa-calendar-alt"></i> Ø¹Ø±Ø¶ Ø§Ù„Ø¬Ø¯ÙˆÙ„ ÙˆØ§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
                </button>
                <button class="btn btn-warning" onclick="printSchedule()">
                    <i class="fas fa-print"></i> Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ø¬Ø¯ÙˆÙ„
                </button>
            </div>

            <div class="medications-list">
                <h2 class="section-title">
                    <i class="fas fa-list"></i> Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£Ø¯ÙˆÙŠØ©
                </h2>
                <div id="medicationsList"></div>
            </div>
        </div>
    </div>

    <!-- Ø²Ø± Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„Ø¹Ø§Ø¦Ù… -->
    <button class="floating-notifications-btn" id="floatingNotificationsBtn" onclick="showMedicationAlert()">
        <i class="fas fa-bell"></i>
    </button>

    <!-- ÙƒÙ„ Ø§Ù„Ù†ÙˆØ§ÙØ° Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© Ø§Ù„Ø£Ø®Ø±Ù‰ -->
    <!-- ... (ÙƒÙ„ Ø§Ù„Ù†ÙˆØ§ÙØ° Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯Ø© Ø³Ø§Ø¨Ù‚Ø§Ù‹) -->

    <!-- Ù†Ø§ÙØ°Ø© ØªÙ†Ø¨ÙŠÙ‡ Ø§Ù„Ø¯ÙˆØ§Ø¡ -->
    <div class="medication-alert-overlay" id="medicationAlert" style="display: none;">
        <div class="medication-alert">
            <div class="alert-header">
                <i class="fas fa-bell fa-3x" style="color: #ff9800;"></i>
                <h3>â° ÙˆÙ‚Øª Ø§Ù„Ø¯ÙˆØ§Ø¡!</h3>
            </div>
            <div class="alert-body">
                <p><strong id="alertMedName">Ø§Ø³Ù… Ø§Ù„Ø¯ÙˆØ§Ø¡</strong></p>
                <p><strong>Ø§Ù„ÙˆÙ‚Øª:</strong> <span id="alertMedTime"></span></p>
                <p><strong>Ø§Ù„Ø¬Ø±Ø¹Ø©:</strong> <span id="alertMedDose"></span></p>
            </div>
            <div class="alert-actions">
                <button class="btn btn-success" onclick="takeMedication()">
                    <i class="fas fa-check"></i> ØªÙ… ØªÙ†Ø§ÙˆÙ„ Ø§Ù„Ø¯ÙˆØ§Ø¡
                </button>
                <button class="btn btn-warning" onclick="snoozeMedication()">
                    <i class="fas fa-clock"></i> ØªØ£Ø¬ÙŠÙ„ 10 Ø¯Ù‚Ø§Ø¦Ù‚
                </button>
                <button class="btn btn-danger" onclick="closeAlert()">
                    <i class="fas fa-times"></i> Ø¥ØºÙ„Ø§Ù‚
                </button>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-messaging.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-analytics.js"></script>

<script>
    // ===== ØªÙƒÙˆÙŠÙ† Firebase =====
    const firebaseConfig = {
        apiKey: "AIzaSyBAcSevspk9_fK4jC1ZkLRhRMNqG9Pv5mU",
        authDomain: "medicine-tracker-a8955.firebaseapp.com",
        projectId: "medicine-tracker-a8955",
        storageBucket: "medicine-tracker-a8955.firebasestorage.app",
        messagingSenderId: "507688371470",
        appId: "1:507688371470:web:e65375310a82e5ba83435f",
        measurementId: "G-SK8M4BFT6Q"
    };

    // ØªÙ‡ÙŠØ¦Ø© Firebase
    let firebaseApp, messaging, analytics;
    try {
        firebaseApp = firebase.initializeApp(firebaseConfig);
        messaging = firebase.messaging();
        analytics = firebase.analytics();
        console.log("Firebase initialized successfully");
    } catch (error) {
        console.error('Firebase initialization error:', error);
    }

    // ===== Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ =====
    let appData = {
        currentUser: null,
        users: {},
        medications: {},
        adminPassword: "admin123"
    };

    // ===== Ù†Ø¸Ø§Ù… Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„Ù…ØªÙ‚Ø¯Ù… =====
    class AdvancedNotificationSystem {
        constructor() {
            this.pushEnabled = localStorage.getItem('pushEnabled') === 'true';
            this.soundEnabled = localStorage.getItem('soundEnabled') !== 'false';
            this.autoRepeat = localStorage.getItem('autoRepeat') !== 'false';
            this.isMuted = localStorage.getItem('isMuted') === 'true';
            this.muteUntil = localStorage.getItem('muteUntil') ? new Date(localStorage.getItem('muteUntil')) : null;
            
            this.currentAlerts = new Map();
            this.retryIntervals = new Map();
            this.fcmToken = null;
            
            this.init();
        }

        async init() {
            this.updateUI();
            this.checkMuteStatus();
            
            if (this.pushEnabled && messaging) {
                await this.enablePushNotifications();
            }
            
            this.startBackgroundChecker();
        }

        updateUI() {
            document.getElementById('pushNotificationsToggle').checked = this.pushEnabled;
            document.getElementById('soundNotificationsToggle').checked = this.soundEnabled;
            document.getElementById('autoRepeatToggle').checked = this.autoRepeat;
            document.getElementById('muteToggle').checked = this.isMuted;
            
            const btn = document.getElementById('floatingNotificationsBtn');
            if (this.isMuted) {
                btn.classList.add('muted');
                btn.classList.remove('active');
            } else if (this.pushEnabled) {
                btn.classList.add('active');
                btn.classList.remove('muted');
            } else {
                btn.classList.remove('active', 'muted');
            }
        }

        async enablePushNotifications() {
            try {
                // Ø·Ù„Ø¨ Ø¥Ø°Ù† Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
                const permission = await Notification.requestPermission();
                if (permission === 'granted') {
                    console.log('Notification permission granted.');
                    
                    // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ FCM Token
                    try {
                        this.fcmToken = await messaging.getToken({
                            vapidKey: 'BEl62iUYg1tjbqR1q1Pycj5-4cCJmZHJ8vR7uK7kYzYjYJ8YJ8YJ8YJ8YJ8YJ8YJ8YJ8YJ8'
                        });
                        console.log('FCM Token:', this.fcmToken);
                        
                        // Ø­ÙØ¸ Token ÙÙŠ localStorage
                        localStorage.setItem('fcmToken', this.fcmToken);
                        
                        // Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ù„Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„ÙˆØ§Ø±Ø¯Ø©
                        messaging.onMessage((payload) => {
                            console.log('Message received:', payload);
                            this.showLocalNotification(payload);
                        });
                        
                        // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªÙˆÙƒÙ† Ø¥Ù„Ù‰ Ø®Ø§Ø¯Ù…Ùƒ (Ø¥Ø°Ø§ ÙƒØ§Ù† Ù„Ø¯ÙŠÙƒ Ø®Ø§Ø¯Ù…)
                        this.sendTokenToServer(this.fcmToken);
                        
                    } catch (tokenError) {
                        console.error('Error getting FCM token:', tokenError);
                    }
                    
                    return true;
                } else {
                    console.log('Unable to get permission to notify.');
                    this.pushEnabled = false;
                    localStorage.setItem('pushEnabled', 'false');
                    this.updateUI();
                    return false;
                }
            } catch (error) {
                console.error('Error enabling push notifications:', error);
                this.pushEnabled = false;
                localStorage.setItem('pushEnabled', 'false');
                this.updateUI();
                return false;
            }
        }

        async sendTokenToServer(token) {
            // Ù‡Ù†Ø§ ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªÙˆÙƒÙ† Ø¥Ù„Ù‰ Ø®Ø§Ø¯Ù…Ùƒ
            // Ù…Ø«Ø§Ù„: fetch('/api/save-token', { method: 'POST', body: JSON.stringify({ token }) })
            console.log('Token ready to send to server:', token);
        }

        disablePushNotifications() {
            this.pushEnabled = false;
            localStorage.setItem('pushEnabled', 'false');
            this.updateUI();
        }

        toggleSound() {
            this.soundEnabled = !this.soundEnabled;
            localStorage.setItem('soundEnabled', this.soundEnabled);
            this.updateUI();
        }

        toggleAutoRepeat() {
            this.autoRepeat = !this.autoRepeat;
            localStorage.setItem('autoRepeat', this.autoRepeat);
            this.updateUI();
        }

        toggleMute(minutes = 10) {
            this.isMuted = !this.isMuted;
            
            if (this.isMuted) {
                this.muteUntil = new Date(Date.now() + minutes * 60000);
                localStorage.setItem('muteUntil', this.muteUntil.toISOString());
                showNotification('ØªÙ… ÙƒØªÙ… Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª', 'Ù„Ù† ØªØªÙ„Ù‚Ù‰ Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ù„Ù…Ø¯Ø© ' + minutes + ' Ø¯Ù‚Ø§Ø¦Ù‚');
            } else {
                this.muteUntil = null;
                localStorage.removeItem('muteUntil');
                showNotification('ØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª', 'Ø³ØªØªÙ„Ù‚Ù‰ Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„Ø£Ø¯ÙˆÙŠØ© ÙƒØ§Ù„Ù…Ø¹ØªØ§Ø¯');
            }
            
            localStorage.setItem('isMuted', this.isMuted);
            this.updateUI();
        }

        checkMuteStatus() {
            if (this.muteUntil && new Date() > this.muteUntil) {
                this.isMuted = false;
                this.muteUntil = null;
                localStorage.removeItem('muteUntil');
                localStorage.setItem('isMuted', 'false');
                this.updateUI();
            }
        }

        startBackgroundChecker() {
            // Ø§Ù„ØªØ­Ù‚Ù‚ ÙƒÙ„ Ø¯Ù‚ÙŠÙ‚Ø© Ù…Ù† Ø­Ø§Ù„Ø© ÙƒØªÙ… Ø§Ù„ØµÙˆØª ÙˆØ§Ù„Ø¬Ø±Ø¹Ø§Øª
            setInterval(() => {
                this.checkMuteStatus();
                this.checkScheduledAlerts();
            }, 60000);
        }

        scheduleMedicationAlert(medication, dose) {
            if (this.isMuted && this.muteUntil > new Date()) return;
            
            const alertId = `${medication.id}-${dose.id}`;
            
            // Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‡Ù†Ø§Ùƒ ØªÙ†Ø¨ÙŠÙ‡ Ù…Ø³Ø¨Ù‚ØŒ Ù„Ø§ Ù†ÙƒØ±Ø±Ù‡
            if (this.currentAlerts.has(alertId)) return;
            
            const alertTime = new Date(dose.dateTime);
            const now = new Date();
            const timeDiff = alertTime - now;
            
            if (timeDiff > 0) {
                // Ø¬Ø¯ÙˆÙ„Ø© Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡ Ù‚Ø¨Ù„ 5 Ø¯Ù‚Ø§Ø¦Ù‚ Ù…Ù† Ø§Ù„Ù…ÙˆØ¹Ø¯
                const adjustedTime = timeDiff - (5 * 60000); // 5 Ø¯Ù‚Ø§Ø¦Ù‚ Ù‚Ø¨Ù„
                const timeoutTime = adjustedTime > 0 ? adjustedTime : timeDiff;
                
                const timeout = setTimeout(() => {
                    this.triggerMedicationAlert(medication, dose);
                }, timeoutTime);
                
                this.currentAlerts.set(alertId, {
                    medication,
                    dose,
                    timeout,
                    retryCount: 0
                });
                
                console.log(`Scheduled alert for ${medication.name} at ${alertTime}`);
            }
        }

        async triggerMedicationAlert(medication, dose) {
            const alertId = `${medication.id}-${dose.id}`;
            const alertInfo = this.currentAlerts.get(alertId);
            
            if (!alertInfo) return;
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ø¥Ø°Ø§ ØªÙ… Ø£Ø®Ø° Ø§Ù„Ø¬Ø±Ø¹Ø© Ø¨Ø§Ù„ÙØ¹Ù„
            if (dose.taken) {
                this.cancelAlert(alertId);
                return;
            }
            
            // Ø¹Ø±Ø¶ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„Ù…Ø­Ù„ÙŠ
            this.showLocalMedicationAlert(medication, dose);
            
            // Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø± Push Ø¥Ø°Ø§ Ù…ÙØ¹Ù„
            if (this.pushEnabled && this.fcmToken) {
                await this.sendPushNotification(medication, dose);
            }
            
            // ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª Ø¥Ø°Ø§ Ù…ÙØ¹Ù„
            if (this.soundEnabled) {
                this.playAlertSound();
            }
            
            // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„ØªÙƒØ±Ø§Ø± Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù…ÙØ¹Ù„Ø§Ù‹ØŒ Ù†Ø¹ÙŠØ¯ Ø§Ù„Ø¬Ø¯ÙˆÙ„Ø©
            if (this.autoRepeat && alertInfo.retryCount < 6) { // 6 Ù…Ø­Ø§ÙˆÙ„Ø§Øª = Ø³Ø§Ø¹Ø© ÙƒØ§Ù…Ù„Ø©
                alertInfo.retryCount++;
                
                // Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø¬Ø¯ÙˆÙ„Ø© Ø¨Ø¹Ø¯ 10 Ø¯Ù‚Ø§Ø¦Ù‚
                const retryTimeout = setTimeout(() => {
                    this.triggerMedicationAlert(medication, dose);
                }, 600000); // 10 Ø¯Ù‚Ø§Ø¦Ù‚
                
                this.retryIntervals.set(alertId, retryTimeout);
            }
        }

        showLocalMedicationAlert(medication, dose) {
            // ØªØ­Ø¯ÙŠØ« ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡
            document.getElementById('alertMedName').textContent = medication.name;
            document.getElementById('alertMedTime').textContent = formatDateTimeTo12Hour(dose.dateTime);
            document.getElementById('alertMedDose').textContent = medication.foodRelation === 'before' ? 'Ù‚Ø¨Ù„ Ø§Ù„Ø£ÙƒÙ„' : 'Ø¨Ø¹Ø¯ Ø§Ù„Ø£ÙƒÙ„';
            
            // Ø­ÙØ¸ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¯ÙˆØ§Ø¡ Ù…Ø¤Ù‚ØªÙ‹Ø§
            window.currentAlertMedication = medication;
            window.currentAlertDose = dose;
            
            // Ø¹Ø±Ø¶ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡
            document.getElementById('medicationAlert').style.display = 'flex';
            
            // ØªØ­Ø¯ÙŠØ« Ø²Ø± Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„Ø¹Ø§Ø¦Ù…
            const btn = document.getElementById('floatingNotificationsBtn');
            btn.innerHTML = '<i class="fas fa-pills"></i>';
            btn.style.background = 'linear-gradient(135deg, #f44336 0%, #c62828 100%)';
            
            // Ø¥Ø¶Ø§ÙØ© Ù…Ø¤Ø´Ø±
            if (!btn.querySelector('.notification-badge')) {
                const badge = document.createElement('span');
                badge.className = 'notification-badge';
                badge.textContent = '!';
                btn.appendChild(badge);
            }
            
            // Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø± Ù…ØªØµÙØ­
            if ('Notification' in window && Notification.permission === 'granted') {
                const notification = new Notification(`â° ÙˆÙ‚Øª Ø§Ù„Ø¯ÙˆØ§Ø¡: ${medication.name}`, {
                    body: `Ø­Ø§Ù† ÙˆÙ‚Øª Ø£Ø®Ø° Ø¬Ø±Ø¹Ø© ${medication.name}\nØ§Ù„ÙˆÙ‚Øª: ${formatDateTimeTo12Hour(dose.dateTime)}`,
                    icon: 'https://cdn-icons-png.flaticon.com/512/206/206875.png',
                    tag: 'medication-alert',
                    requireInteraction: true
                });
                
                notification.onclick = () => {
                    window.focus();
                    this.markAsTaken(medication, dose);
                    notification.close();
                };
            }
        }

        async sendPushNotification(medication, dose) {
            try {
                // ÙÙŠ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØŒ Ù‡Ù†Ø§ ØªØ±Ø³Ù„ Ø§Ù„Ø·Ù„Ø¨ Ø¥Ù„Ù‰ Ø®Ø§Ø¯Ù…Ùƒ
                // Ø§Ù„Ø°ÙŠ Ø¨Ø¯ÙˆØ±Ù‡ ÙŠØ±Ø³Ù„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± Ø¹Ø¨Ø± FCM
                console.log('Sending push notification for:', medication.name);
                
                // Ù„Ù…Ø­Ø§ÙƒØ§Ø© Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø± Push
                if ('serviceWorker' in navigator && this.fcmToken) {
                    navigator.serviceWorker.ready.then(registration => {
                        registration.showNotification(`â° ÙˆÙ‚Øª Ø§Ù„Ø¯ÙˆØ§Ø¡: ${medication.name}`, {
                            body: `Ø­Ø§Ù† ÙˆÙ‚Øª Ø£Ø®Ø° Ø¬Ø±Ø¹Ø© ${medication.name}\nØ§Ù„ÙˆÙ‚Øª: ${formatDateTimeTo12Hour(dose.dateTime)}`,
                            icon: 'https://cdn-icons-png.flaticon.com/512/206/206875.png',
                            requireInteraction: true,
                            vibrate: [200, 100, 200],
                            tag: 'medication-alert',
                            actions: [
                                { action: 'take', title: 'âœ… ØªÙ… Ø§Ù„Ø£Ø®Ø°' },
                                { action: 'snooze', title: 'â° ØªØ£Ø¬ÙŠÙ„' }
                            ],
                            data: {
                                medicationId: medication.id,
                                doseId: dose.id
                            }
                        });
                    });
                }
            } catch (error) {
                console.error('Error sending push notification:', error);
            }
        }

        playAlertSound() {
            try {
                // Ø¥Ù†Ø´Ø§Ø¡ ØµÙˆØª ØªÙ†Ø¨ÙŠÙ‡ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Web Audio API
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.value = 800;
                oscillator.type = 'sine';
                
                // ØªØ´ØºÙŠÙ„ Ø§Ù„Ù†ØºÙ…Ø©
                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 1);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 1);
            } catch (error) {
                console.log('Audio not supported, using fallback');
                // Ø¨Ø¯ÙŠÙ„ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… HTML5 Audio
                const audio = new Audio('data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEAQB8AAEAfAAABAAgAZGF0YQ');
                audio.play().catch(e => console.log('Audio play failed:', e));
            }
        }

        cancelAlert(alertId) {
            const alertInfo = this.currentAlerts.get(alertId);
            if (alertInfo) {
                clearTimeout(alertInfo.timeout);
                this.currentAlerts.delete(alertId);
            }
            
            const retryInterval = this.retryIntervals.get(alertId);
            if (retryInterval) {
                clearTimeout(retryInterval);
                this.retryIntervals.delete(alertId);
            }
        }

        cancelAllAlerts() {
            this.currentAlerts.forEach((alertInfo, alertId) => {
                clearTimeout(alertInfo.timeout);
            });
            this.currentAlerts.clear();
            
            this.retryIntervals.forEach(interval => {
                clearTimeout(interval);
            });
            this.retryIntervals.clear();
        }

        checkScheduledAlerts() {
            if (!appData.currentUser) return;
            
            const username = appData.currentUser.id;
            const medications = appData.medications[username] || [];
            const now = new Date();
            
            medications.forEach(med => {
                med.doses.forEach(dose => {
                    if (!dose.taken) {
                        const doseTime = new Date(dose.dateTime);
                        const timeDiff = doseTime - now;
                        const minutesDiff = Math.floor(timeDiff / (1000 * 60));
                        
                        // Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ø¬Ø±Ø¹Ø© Ø®Ù„Ø§Ù„ Ø§Ù„Ø³Ø§Ø¹Ø© Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©
                        if (minutesDiff >= 0 && minutesDiff <= 60) {
                            this.scheduleMedicationAlert(med, dose);
                        }
                    }
                });
            });
        }

        showLocalNotification(payload) {
            if ('Notification' in window && Notification.permission === 'granted') {
                new Notification(payload.notification.title, {
                    body: payload.notification.body,
                    icon: payload.notification.icon
                });
            }
        }

        markAsTaken(medication, dose) {
            if (!appData.currentUser) return;
            
            const username = appData.currentUser.id;
            const medications = appData.medications[username] || [];
            const med = medications.find(m => m.id === medication.id);
            
            if (med) {
                const doseObj = med.doses.find(d => d.id === dose.id);
                if (doseObj) {
                    doseObj.taken = true;
                    doseObj.takenTime = new Date().toISOString();
                    
                    // Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ù„Ù‡Ø°Ù‡ Ø§Ù„Ø¬Ø±Ø¹Ø©
                    this.cancelAlert(`${medication.id}-${dose.id}`);
                    
                    // Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                    saveToLocalStorage();
                    
                    // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡
                    closeAlert();
                    
                    // Ø¥Ø¸Ù‡Ø§Ø± Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„Ù†Ø¬Ø§Ø­
                    showNotification(`ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø£Ø®Ø° ${medication.name}`, 'success');
                    
                    // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
                    renderUserMedications();
                }
            }
        }
    }

    // ===== ØªÙ‡ÙŠØ¦Ø© Ù†Ø¸Ø§Ù… Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª =====
    let notificationSystem;

    function initNotificationSystem() {
        try {
            notificationSystem = new AdvancedNotificationSystem();
            
            // Ø¬Ø¯ÙˆÙ„Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¬Ø±Ø¹Ø§Øª Ø§Ù„Ù‚Ø§Ø¯Ù…Ø© Ø¹Ù†Ø¯ Ø§Ù„Ø¨Ø¯Ø¡
            setTimeout(() => {
                if (notificationSystem) {
                    notificationSystem.checkScheduledAlerts();
                }
            }, 2000);
            
            // ØªØ³Ø¬ÙŠÙ„ Service Worker
            registerServiceWorker();
            
        } catch (error) {
            console.error('Error initializing notification system:', error);
        }
    }

    async function registerServiceWorker() {
        if ('serviceWorker' in navigator) {
            try {
                const registration = await navigator.serviceWorker.register('/firebase-messaging-sw.js');
                console.log('Service Worker registered:', registration);
                
                // Ø¥Ø¹Ø¯Ø§Ø¯ Ù…Ø±Ø§Ø³Ù„Ø© Firebase Ù„Ù€ Service Worker
                if (messaging) {
                    messaging.useServiceWorker(registration);
                }
            } catch (error) {
                console.error('Service Worker registration failed:', error);
            }
        }
    }

    // ===== Ø¯ÙˆØ§Ù„ Ø§Ù„ØªØ­ÙƒÙ… Ù…Ù† Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© =====
    function togglePushNotifications() {
        if (!notificationSystem) return;
        
        if (notificationSystem.pushEnabled) {
            notificationSystem.disablePushNotifications();
            showNotification('ØªÙ… ØªØ¹Ø·ÙŠÙ„ Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Push');
        } else {
            notificationSystem.enablePushNotifications().then(success => {
                if (success) {
                    showNotification('ØªÙ… ØªÙØ¹ÙŠÙ„ Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Push');
                }
            });
        }
    }

    function toggleSoundNotifications() {
        if (notificationSystem) {
            notificationSystem.toggleSound();
            showNotification(notificationSystem.soundEnabled ? 
                'ØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø§Ù„ØµÙˆØªÙŠØ©' : 'ØªÙ… ØªØ¹Ø·ÙŠÙ„ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø§Ù„ØµÙˆØªÙŠØ©');
        }
    }

    function toggleAutoRepeat() {
        if (notificationSystem) {
            notificationSystem.toggleAutoRepeat();
            showNotification(notificationSystem.autoRepeat ? 
                'ØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„ØªÙƒØ±Ø§Ø± Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ' : 'ØªÙ… ØªØ¹Ø·ÙŠÙ„ Ø§Ù„ØªÙƒØ±Ø§Ø± Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ');
        }
    }

    function toggleMute() {
        if (notificationSystem) {
            notificationSystem.toggleMute();
        }
    }

    function testNotification() {
        if (!appData.currentUser) return;
        
        const testMedication = {
            id: 'test',
            name: 'Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±',
            foodRelation: 'before'
        };
        
        const testDose = {
            id: 'test-dose',
            dateTime: new Date().toISOString(),
            taken: false
        };
        
        if (notificationSystem) {
            notificationSystem.showLocalMedicationAlert(testMedication, testDose);
            showNotification('ØªÙ… Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±', 'success');
        }
    }

    function showMedicationAlert() {
        // Ù‡Ø°Ø§ ÙŠØ¸Ù‡Ø± Ø¢Ø®Ø± ØªÙ†Ø¨ÙŠÙ‡ Ù†Ø´Ø·
        const alertDiv = document.getElementById('medicationAlert');
        if (alertDiv.style.display === 'flex') {
            alertDiv.style.display = 'none';
        } else {
            testNotification();
        }
    }

    function takeMedication() {
        if (notificationSystem && window.currentAlertMedication && window.currentAlertDose) {
            notificationSystem.markAsTaken(window.currentAlertMedication, window.currentAlertDose);
        } else {
            showNotification('ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø£Ø®Ø° Ø§Ù„Ø¯ÙˆØ§Ø¡', 'success');
            closeAlert();
        }
    }

    function snoozeMedication() {
        if (notificationSystem) {
            notificationSystem.toggleMute(10);
            closeAlert();
        }
    }

    function closeAlert() {
        document.getElementById('medicationAlert').style.display = 'none';
        
        // Ø¥Ø¹Ø§Ø¯Ø© Ø²Ø± Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„Ø¹Ø§Ø¦Ù…
        const btn = document.getElementById('floatingNotificationsBtn');
        btn.innerHTML = '<i class="fas fa-bell"></i>';
        
        const badge = btn.querySelector('.notification-badge');
        if (badge) {
            badge.remove();
        }
        
        if (notificationSystem) {
            if (notificationSystem.isMuted) {
                btn.style.background = 'linear-gradient(135deg, #f44336 0%, #c62828 100%)';
            } else if (notificationSystem.pushEnabled) {
                btn.style.background = 'linear-gradient(135deg, #4CAF50 0%, #2e7d32 100%)';
            } else {
                btn.style.background = 'linear-gradient(135deg, #ff9800 0%, #f57c00 100%)';
            }
        }
    }

    // ===== Ø¯Ù…Ø¬ Ù†Ø¸Ø§Ù… Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ù…Ø¹ Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ =====
    // ØªØ­Ø¯ÙŠØ« Ø¯Ø§Ù„Ø© init Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
    function init() {
        loadTheme();
        loadFromLocalStorage();
        restoreSession();
        updateCurrentDate();
        setInterval(updateCurrentDate, 60000);
        initNotificationSystem(); // Ø¥Ø¶Ø§ÙØ© Ù‡Ø°Ø§ Ø§Ù„Ø³Ø·Ø±
        
        // Ø¥Ø¶Ø§ÙØ© Ù…Ø¹Ø§Ù„Ø¬Ø§Øª Ù„Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
        setupNotificationHandlers();
    }

    function setupNotificationHandlers() {
        // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ù…Ù† Service Worker
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.addEventListener('message', event => {
                if (event.data && event.data.type === 'TAKE_MEDICATION') {
                    takeMedication();
                } else if (event.data && event.data.type === 'SNOOZE_MEDICATION') {
                    snoozeMedication();
                }
            });
        }
    }

    // ===== Ø¨Ù‚ÙŠØ© Ø¯ÙˆØ§Ù„ Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ =====
    let editingMedicationId = null;
    let editingUserId = null;

    function updateCurrentDate() {
        const now = new Date();
        const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
        document.getElementById('currentDate').textContent = now.toLocaleDateString('ar-SA', options);
    }

    function generateId() {
        return Date.now() + Math.random().toString(36).substr(2, 9);
    }

    function showLoginPage() {
        document.getElementById('loginPage').classList.add('active');
        document.getElementById('adminPage').classList.remove('active');
        document.getElementById('userPage').classList.remove('active');
    }

    function showAdminPage() {
        document.getElementById('loginPage').classList.remove('active');
        document.getElementById('adminPage').classList.add('active');
        document.getElementById('userPage').classList.remove('active');
        renderAdminUserList();
    }

    function showUserPage() {
        document.getElementById('loginPage').classList.remove('active');
        document.getElementById('adminPage').classList.remove('active');
        document.getElementById('userPage').classList.add('active');
        renderUserInfo();
        renderUserMedications();
        
        // Ø¬Ø¯ÙˆÙ„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø¹Ù†Ø¯ ÙØªØ­ ØµÙØ­Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
        if (notificationSystem) {
            setTimeout(() => {
                notificationSystem.checkScheduledAlerts();
            }, 1000);
        }
    }

    function restoreSession() {
        const savedSession = localStorage.getItem('currentSession');
        if (savedSession) {
            try {
                const session = JSON.parse(savedSession);
                if (session.userId && session.isLoggedIn) {
                    if (session.userId === 'admin') {
                        appData.currentUser = {
                            id: 'admin',
                            name: 'Ù…Ø¯ÙŠØ± Ø§Ù„Ù†Ø¸Ø§Ù…',
                            isAdmin: true
                        };
                        showAdminPage();
                    } else if (appData.users[session.userId]) {
                        const user = appData.users[session.userId];
                        appData.currentUser = {
                            id: session.userId,
                            name: user.name,
                            age: user.age,
                            isAdmin: false
                        };
                        showUserPage();
                    }
                }
            } catch (err) {
                console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ø¬Ù„Ø³Ø©:', err);
                showLoginPage();
            }
        } else {
            showLoginPage();
        }
    }

    function saveSession() {
        if (appData.currentUser) {
            const session = {
                userId: appData.currentUser.id,
                isLoggedIn: true,
                timestamp: new Date().toISOString()
            };
            localStorage.setItem('currentSession', JSON.stringify(session));
        }
    }

    function clearSession() {
        localStorage.removeItem('currentSession');
    }

    function login() {
        const username = document.getElementById('loginUsername').value.trim();
        const password = document.getElementById('loginPassword').value.trim();

        if (!username || !password) {
            showNotification('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙˆÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±', 'error');
            return;
        }

        // ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Admin
        if (username === 'admin' && password === appData.adminPassword) {
            appData.currentUser = {
                id: 'admin',
                name: 'Ù…Ø¯ÙŠØ± Ø§Ù„Ù†Ø¸Ø§Ù…',
                isAdmin: true
            };
            saveSession();
            showAdminPage();
            showNotification('Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙŠØ§ Ù…Ø¯ÙŠØ± Ø§Ù„Ù†Ø¸Ø§Ù…');
            return;
        }

        // ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ù…Ø³ØªØ®Ø¯Ù… Ø¹Ø§Ø¯ÙŠ
        const user = appData.users[username];
        if (user && user.password === password) {
            appData.currentUser = {
                id: username,
                name: user.name,
                age: user.age,
                isAdmin: false
            };
            saveSession();
            showUserPage();
            showNotification(`Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ${user.name}`);
            return;
        }

        showNotification('Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø£Ùˆ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©', 'error');
    }

    function register() {
        const username = document.getElementById('regUsername').value.trim();
        const password = document.getElementById('regPassword').value.trim();
        const name = document.getElementById('regName').value.trim();
        const age = document.getElementById('regAge').value.trim();

        if (!username || !password || !name) {
            showNotification('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©', 'error');
            return;
        }

        if (appData.users[username]) {
            showNotification('Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…ÙˆØ¬ÙˆØ¯ Ø¨Ø§Ù„ÙØ¹Ù„', 'error');
            return;
        }

        // Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø³ØªØ®Ø¯Ù… Ø¬Ø¯ÙŠØ¯
        appData.users[username] = {
            id: username,
            name: name,
            age: age || '',
            password: password,
            createdAt: new Date().toISOString()
        };

        // Ø¥Ù†Ø´Ø§Ø¡ Ù‚Ø§Ø¦Ù…Ø© Ø£Ø¯ÙˆÙŠØ© ÙØ§Ø±ØºØ© Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…
        appData.medications[username] = [];

        saveToLocalStorage();
        showNotification('ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø¨Ù†Ø¬Ø§Ø­');
        
        // ØªÙØ±ÙŠØº Ø§Ù„Ø­Ù‚ÙˆÙ„
        document.getElementById('regUsername').value = '';
        document.getElementById('regPassword').value = '';
        document.getElementById('regName').value = '';
        document.getElementById('regAge').value = '';
        closeModal('registerModal');
    }

    function logout() {
        appData.currentUser = null;
        clearSession();
        showLoginPage();
        showNotification('ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬');
    }

    function renderUserInfo() {
        if (!appData.currentUser) return;

        const userInfoDiv = document.getElementById('userInfo');
        userInfoDiv.innerHTML = `
            <div class="user-avatar">
                <i class="fas fa-user"></i>
            </div>
            <div class="user-details">
                <div class="user-name">${appData.currentUser.name}</div>
                <div class="user-age">${appData.currentUser.age ? `Ø§Ù„Ø¹Ù…Ø±: ${appData.currentUser.age} Ø³Ù†Ø©` : ''}</div>
                <div style="margin-top: 10px; color: #666;">
                    <i class="fas fa-bell"></i> 
                    ${notificationSystem ? 
                        (notificationSystem.pushEnabled ? 'Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Push Ù…ÙØ¹Ù„Ø©' : 'Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ© ÙÙ‚Ø·') : 
                        'Ø¬Ø§Ø±ÙŠ ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª...'}
                </div>
            </div>
            ${appData.currentUser.id !== 'admin' ? `
                <button class="btn btn-danger delete-user-btn" onclick="openDeleteUserModal()">
                    <i class="fas fa-trash"></i> Ø­Ø°Ù Ø­Ø³Ø§Ø¨ÙŠ
                </button>
            ` : ''}
        `;
    }

    function renderUserMedications() {
        const container = document.getElementById('medicationsList');
        const username = appData.currentUser.id;
        const medications = appData.medications[username] || [];

        if (medications.length === 0) {
            container.innerHTML = `
                <div class="empty-state">
                    <i class="fas fa-inbox"></i>
                    <p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø¯ÙˆÙŠØ©. Ù‚Ù… Ø¨Ø¥Ø¶Ø§ÙØ© Ø¯ÙˆØ§Ø¡ Ø¬Ø¯ÙŠØ¯</p>
                </div>
            `;
            return;
        }

        container.innerHTML = medications.map(med => {
            const totalDoses = med.doses.length;
            const takenDoses = med.doses.filter(d => d.taken).length;
            const adherence = totalDoses > 0 ? Math.round((takenDoses / totalDoses) * 100) : 0;

            const foodText = {
                'before': 'Ù‚Ø¨Ù„ Ø§Ù„Ø£ÙƒÙ„',
                'after': 'Ø¨Ø¹Ø¯ Ø§Ù„Ø£ÙƒÙ„',
                'none': 'Ù„Ø§ Ø¹Ù„Ø§Ù‚Ø© Ø¨Ø§Ù„Ø·Ø¹Ø§Ù…'
            };

            return `
                <div class="medication-card">
                    <div class="medication-header">
                        <div class="medication-name-wrapper">
                            <span class="medication-name">${med.name}</span>
                            <span class="medication-type type-${med.type}">
                                ${getTypeLabel(med.type)}
                            </span>
                        </div>
                        <div class="medication-actions">
                            <button class="btn btn-info" onclick="openEditMedicationModal('${med.id}')">
                                <i class="fas fa-edit"></i> ØªØ¹Ø¯ÙŠÙ„
                            </button>
                            <button class="btn btn-danger" onclick="deleteMedication('${med.id}')">
                                <i class="fas fa-trash"></i> Ø­Ø°Ù
                            </button>
                        </div>
                    </div>
                    <div class="medication-info">
                        <div class="info-item">
                            <i class="fas fa-calendar-alt"></i>
                            <span>Ø§Ù„Ø¨Ø¯Ø¡: ${med.startDate}</span>
                        </div>
                        <div class="info-item">
                            <i class="fas fa-clock"></i>
                            <span>Ø£ÙˆÙ„ Ø¬Ø±Ø¹Ø©: ${formatTimeTo12Hour(med.startTime)}</span>
                        </div>
                        <div class="info-item">
                            <i class="fas fa-hourglass-half"></i>
                            <span>Ø§Ù„Ù…Ø¯Ø©: ${med.duration} ÙŠÙˆÙ…</span>
                        </div>
                        <div class="info-item">
                            <i class="fas fa-redo"></i>
                            <span>${med.frequency} Ø¬Ø±Ø¹Ø§Øª/ÙŠÙˆÙ…</span>
                        </div>
                        <div class="info-item">
                            <i class="fas fa-utensils"></i>
                            <span>${foodText[med.foodRelation]}</span>
                        </div>
                        <div class="info-item">
                            <i class="fas fa-chart-line"></i>
                            <span>Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…: ${adherence}%</span>
                        </div>
                    </div>
                </div>
            `;
        }).join('');
    }

    function renderAdminUserList() {
        const container = document.getElementById('adminUserList');
        const users = Object.values(appData.users).filter(user => user.id !== 'admin');

        if (users.length === 0) {
            container.innerHTML = `
                <div class="empty-state">
                    <i class="fas fa-users"></i>
                    <p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø­Ø³Ø§Ø¨Ø§Øª Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</p>
                </div>
            `;
            return;
        }

        container.innerHTML = users.map(user => {
            const userMedications = appData.medications[user.id] || [];
            const totalMeds = userMedications.length;
            
            let totalDoses = 0;
            let takenDoses = 0;
            
            userMedications.forEach(med => {
                totalDoses += med.doses.length;
                takenDoses += med.doses.filter(d => d.taken).length;
            });
            
            const adherence = totalDoses > 0 ? Math.round((takenDoses / totalDoses) * 100) : 0;

            return `
                <div class="admin-user-card">
                    <div class="admin-user-info">
                        <div class="admin-user-avatar">
                            <i class="fas fa-user"></i>
                        </div>
                        <div class="admin-user-details">
                            <h3>${user.name}</h3>
                            <div>Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…: ${user.id}</div>
                            ${user.age ? `<div>Ø§Ù„Ø¹Ù…Ø±: ${user.age} Ø³Ù†Ø©</div>` : ''}
                        </div>
                    </div>
                    <div class="admin-user-stats">
                        <div><i class="fas fa-pills"></i> ${totalMeds} Ø¯ÙˆØ§Ø¡</div>
                        <div><i class="fas fa-check-circle"></i> ${adherence}% Ø§Ù„ØªØ²Ø§Ù…</div>
                    </div>
                    <button class="btn btn-danger" onclick="openAdminDeleteUserModal('${user.id}')">
                        <i class="fas fa-trash"></i> Ø­Ø°Ù
                    </button>
                </div>
            `;
        }).join('');
    }

    function openAddMedicationModal() {
        editingMedicationId = null;
        document.getElementById('modalTitle').innerHTML = '<i class="fas fa-plus-circle"></i> Ø¥Ø¶Ø§ÙØ© Ø¯ÙˆØ§Ø¡ Ø¬Ø¯ÙŠØ¯';
        document.getElementById('medName').value = '';
        document.getElementById('medType').value = 'pill';
        
        const today = new Date();
        const defaultDate = today.toISOString().split('T')[0];
        document.getElementById('medStartDate').value = defaultDate;
        
        // Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø­Ø§Ù„ÙŠ + 5 Ø¯Ù‚Ø§Ø¦Ù‚
        const defaultTime = new Date(today.getTime() + 5 * 60000);
        const hours = defaultTime.getHours().toString().padStart(2, '0');
        const minutes = defaultTime.getMinutes().toString().padStart(2, '0');
        document.getElementById('medStartTime').value = `${hours}:${minutes}`;
        
        document.getElementById('medDuration').value = '7';
        document.getElementById('medFrequency').value = '3';
        document.getElementById('medFoodRelation').value = 'before';

        document.getElementById('medicationModal').classList.add('active');
    }

    function openEditMedicationModal(id) {
        const username = appData.currentUser.id;
        const medications = appData.medications[username] || [];
        editingMedicationId = id;
        
        const med = medications.find(m => m.id === id);
        if (!med) return;

        document.getElementById('modalTitle').innerHTML = '<i class="fas fa-edit"></i> ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¯ÙˆØ§Ø¡';
        document.getElementById('medName').value = med.name;
        document.getElementById('medType').value = med.type;
        document.getElementById('medStartDate').value = med.startDate;
        document.getElementById('medStartTime').value = med.startTime;
        document.getElementById('medDuration').value = med.duration;
        document.getElementById('medFrequency').value = med.frequency;
        document.getElementById('medFoodRelation').value = med.foodRelation;

        document.getElementById('medicationModal').classList.add('active');
    }

    function saveMedication() {
        if (!appData.currentUser) return;

        const username = appData.currentUser.id;
        const name = document.getElementById('medName').value.trim();
        const type = document.getElementById('medType').value;
        const startDate = document.getElementById('medStartDate').value;
        const startTime = document.getElementById('medStartTime').value;
        const duration = parseInt(document.getElementById('medDuration').value);
        const frequency = parseInt(document.getElementById('medFrequency').value);
        const foodRelation = document.getElementById('medFoodRelation').value;

        if (!name || !startDate || !startTime || !duration || !frequency) {
            showNotification('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„', 'error');
            return;
        }

        if (!appData.medications[username]) {
            appData.medications[username] = [];
        }

        if (editingMedicationId) {
            const medIndex = appData.medications[username].findIndex(m => m.id === editingMedicationId);
            if (medIndex !== -1) {
                appData.medications[username][medIndex] = {
                    id: editingMedicationId,
                    name: name,
                    type: type,
                    startDate: startDate,
                    startTime: startTime,
                    duration: duration,
                    frequency: frequency,
                    foodRelation: foodRelation,
                    doses: generateDosesForMedication(startDate, startTime, duration, frequency)
                };
                showNotification(`ØªÙ… ØªØ¹Ø¯ÙŠÙ„ Ø¯ÙˆØ§Ø¡ "${name}" Ø¨Ù†Ø¬Ø§Ø­`);
            }
        } else {
            const medication = {
                id: generateId(),
                name: name,
                type: type,
                startDate: startDate,
                startTime: startTime,
                duration: duration,
                frequency: frequency,
                foodRelation: foodRelation,
                doses: generateDosesForMedication(startDate, startTime, duration, frequency)
            };

            appData.medications[username].push(medication);
            showNotification(`ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø¯ÙˆØ§Ø¡ "${name}" Ø¨Ù†Ø¬Ø§Ø­`);
        }

        closeModal('medicationModal');
        saveToLocalStorage();
        
        // Ø¥Ø¹Ø§Ø¯Ø© Ø¬Ø¯ÙˆÙ„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
        if (notificationSystem) {
            notificationSystem.cancelAllAlerts();
            setTimeout(() => {
                notificationSystem.checkScheduledAlerts();
            }, 1000);
        }
        
        if (appData.currentUser.isAdmin) {
            renderAdminUserList();
        } else {
            renderUserMedications();
        }
    }

    function generateDosesForMedication(startDate, startTime, duration, frequency) {
        const doses = [];
        const [startHour, startMinute] = startTime.split(':').map(Number);
        const startDateTime = new Date(startDate + 'T' + startTime + ':00');
        const intervalHours = 24 / frequency;

        for (let day = 0; day < duration; day++) {
            for (let i = 0; i < frequency; i++) {
                const doseDateTime = new Date(startDateTime);
                doseDateTime.setHours(startDateTime.getHours() + (day * 24) + (i * intervalHours));

                doses.push({
                    id: generateId(),
                    dateTime: doseDateTime.toISOString(),
                    taken: false,
                    takenTime: null,
                    note: ''
                });
            }
        }

        doses.sort((a, b) => new Date(a.dateTime) - new Date(b.dateTime));
        return doses;
    }

    function deleteMedication(id) {
        if (!appData.currentUser || !confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø¯ÙˆØ§Ø¡ØŸ')) return;

        const username = appData.currentUser.id;
        appData.medications[username] = appData.medications[username].filter(m => m.id !== id);
        
        saveToLocalStorage();
        renderUserMedications();
        
        // Ø¥Ø¹Ø§Ø¯Ø© Ø¬Ø¯ÙˆÙ„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
        if (notificationSystem) {
            notificationSystem.cancelAllAlerts();
            setTimeout(() => {
                notificationSystem.checkScheduledAlerts();
            }, 1000);
        }
        
        showNotification('ØªÙ… Ø­Ø°Ù Ø§Ù„Ø¯ÙˆØ§Ø¡');
    }

    function openSchedulePage() {
        if (!appData.currentUser) return;
        
        saveToLocalStorage();
        saveSession();
        
        window.open('schedule.html?user=' + encodeURIComponent(appData.currentUser.id), '_blank');
    }

    function closeModal(modalId) {
        document.getElementById(modalId).classList.remove('active');
        editingMedicationId = null;
        editingUserId = null;
    }

    function formatTimeTo12Hour(timeStr) {
        if (!timeStr) return '';
        
        const [hours, minutes] = timeStr.split(':').map(Number);
        const ampm = hours >= 12 ? 'Ù…' : 'Øµ';
        let hours12 = hours % 12;
        hours12 = hours12 ? hours12 : 12;
        return `${hours12}:${minutes.toString().padStart(2, '0')} ${ampm}`;
    }

    function formatDateTimeTo12Hour(dateTimeStr) {
        if (!dateTimeStr) return '';
        
        const date = new Date(dateTimeStr);
        const hours = date.getHours();
        const minutes = date.getMinutes();
        const ampm = hours >= 12 ? 'Ù…' : 'Øµ';
        let hours12 = hours % 12;
        hours12 = hours12 ? hours12 : 12;
        return `${hours12}:${minutes.toString().padStart(2, '0')} ${ampm}`;
    }

    function getTypeLabel(type) {
        const labels = {
            'pill': 'Ø­Ø¨ÙˆØ¨',
            'capsule': 'ÙƒØ¨Ø³ÙˆÙ„Ø§Øª',
            'syrup': 'Ø´Ø±Ø§Ø¨',
            'drops': 'Ù‚Ø·Ø±Ø©',
            'injection': 'Ø­Ù‚Ù†',
            'cream': 'ÙƒØ±ÙŠÙ…',
            'inhaler': 'Ø¨Ø®Ø§Ø®',
            'other': 'Ø£Ø®Ø±Ù‰'
        };
        return labels[type] || 'Ø£Ø®Ø±Ù‰';
    }

    function printSchedule() {
        if (!appData.currentUser) return;
        
        saveToLocalStorage();
        saveSession();
        
        const printWindow = window.open('schedule.html?user=' + encodeURIComponent(appData.currentUser.id) + '&print=true', '_blank');
        
        setTimeout(() => {
            if (printWindow) {
                printWindow.onload = function() {
                    printWindow.print();
                };
            }
        }, 1000);
    }

    function toggleTheme() {
        document.body.classList.toggle('dark-mode');
        const btn = document.querySelector('.theme-toggle');
        btn.textContent = document.body.classList.contains('dark-mode') ? 'â˜€ï¸' : 'ğŸŒ™';
        localStorage.setItem('theme', document.body.classList.contains('dark-mode') ? 'dark' : 'light');
    }

    function loadTheme() {
        const theme = localStorage.getItem('theme');
        if (theme === 'dark') {
            document.body.classList.add('dark-mode');
            const themeButtons = document.querySelectorAll('.theme-toggle');
            themeButtons.forEach(btn => {
                btn.textContent = 'â˜€ï¸';
            });
        }
    }

    function saveToLocalStorage() {
        localStorage.setItem('medicationsAppData', JSON.stringify(appData));
    }

    function loadFromLocalStorage() {
        const saved = localStorage.getItem('medicationsAppData');
        if (saved) {
            try {
                const data = JSON.parse(saved);
                
                appData.users = data.users || {};
                appData.medications = data.medications || {};
                appData.adminPassword = data.adminPassword || "admin123";
                
                if (!appData.users['admin']) {
                    appData.users['admin'] = {
                        id: 'admin',
                        name: 'Ù…Ø¯ÙŠØ± Ø§Ù„Ù†Ø¸Ø§Ù…',
                        password: appData.adminPassword,
                        isAdmin: true,
                        createdAt: new Date().toISOString()
                    };
                }
            } catch (err) {
                console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:', err);
                appData.users = {
                    'admin': {
                        id: 'admin',
                        name: 'Ù…Ø¯ÙŠØ± Ø§Ù„Ù†Ø¸Ø§Ù…',
                        password: appData.adminPassword,
                        isAdmin: true,
                        createdAt: new Date().toISOString()
                    }
                };
                appData.medications = {};
            }
        } else {
            appData.users = {
                'admin': {
                    id: 'admin',
                    name: 'Ù…Ø¯ÙŠØ± Ø§Ù„Ù†Ø¸Ø§Ù…',
                    password: appData.adminPassword,
                    isAdmin: true,
                    createdAt: new Date().toISOString()
                }
            };
            appData.medications = {};
        }
    }

    function showNotification(message, type = 'success') {
        const notification = document.getElementById('notification');
        const text = document.getElementById('notificationText');
        const icon = notification.querySelector('i');

        text.textContent = message;
        notification.className = 'notification ' + type;

        if (type === 'error') {
            icon.className = 'fas fa-exclamation-circle';
        } else {
            icon.className = 'fas fa-check-circle';
        }

        notification.classList.add('show');

        setTimeout(() => {
            notification.classList.remove('show');
        }, 3000);
    }

    // Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªØ®Ø¯Ù… ØªØ¬Ø±ÙŠØ¨ÙŠ
    document.addEventListener('DOMContentLoaded', () => {
        init();
        
        if (!appData.users['test']) {
            appData.users['test'] = {
                id: 'test',
                name: 'Ù…Ø³ØªØ®Ø¯Ù… ØªØ¬Ø±ÙŠØ¨ÙŠ',
                age: '30',
                password: 'test123',
                createdAt: new Date().toISOString()
            };
            appData.medications['test'] = [];
            saveToLocalStorage();
        }
        
        // Ø·Ù„Ø¨ Ø¥Ø°Ù† Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
        if ('Notification' in window && Notification.permission === 'default') {
            setTimeout(() => {
                if (confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ø£Ø¯ÙˆÙŠØ©ØŸ')) {
                    Notification.requestPermission();
                }
            }, 2000);
        }
    });
</script>
</body>
</html>