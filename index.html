<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù†Ø¸Ø§Ù… Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ø£Ø¯ÙˆÙŠØ© Ø§Ù„Ù…ØªÙ‚Ø¯Ù… - Ù…ØªØ¹Ø¯Ø¯ Ø§Ù„Ø£Ø´Ø®Ø§Øµ</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Cairo', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            direction: rtl;
            transition: all 0.3s ease;
        }

        body.dark-mode {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
        }

        /* ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ù„ØºØ© */
        .language-switcher {
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 1000;
            display: flex;
            gap: 10px;
        }

        .lang-btn {
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 600;
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .lang-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }

        /* === Ø¥Ø®ÙØ§Ø¡ Ø§Ù„ØµÙØ­Ø§Øª === */
        .page {
            display: none;
        }

        .page.active {
            display: block;
        }

        /* === ØµÙØ­Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© === */
        .user-page {
            display: block;
        }

        .container {
            max-width: 1800px;
            margin: 0 auto;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
            margin-bottom: 30px;
            text-align: center;
            position: relative;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        body.dark-mode .header {
            background: rgba(44, 44, 62, 0.95);
            color: #e0e0e0;
            border-color: rgba(255, 255, 255, 0.1);
        }

        .user-controls {
            position: absolute;
            top: 20px;
            left: 20px;
            display: flex;
            gap: 10px;
        }

        .theme-toggle {
            background: #667eea;
            color: white;
            border: none;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 24px;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .theme-toggle:hover {
            transform: scale(1.1);
        }

        body.dark-mode .theme-toggle {
            background: #ffd700;
            color: #1a1a2e;
        }

        .logout-btn {
            background: #f44336;
            color: white;
            border: none;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 20px;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .logout-btn:hover {
            transform: scale(1.1);
        }

        h1 {
            font-size: 2.5rem;
            color: #0d47a1;
            margin-bottom: 10px;
        }

        body.dark-mode h1 {
            color: #8fa3f5;
        }

        .subtitle {
            color: #666;
            font-size: 1.1rem;
        }

        body.dark-mode .subtitle {
            color: #999;
        }

        .current-date {
            margin-top: 15px;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 12px;
            font-size: 1.2rem;
            font-weight: bold;
        }

        body.dark-mode .current-date {
            background: linear-gradient(135deg, #0f3460 0%, #16213e 100%);
        }

        .main-controls {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            padding: 25px;
            border-radius: 20px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: center;
            justify-content: center;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        body.dark-mode .main-controls {
            background: rgba(44, 44, 62, 0.95);
            border-color: rgba(255, 255, 255, 0.1);
        }

        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-success {
            background: linear-gradient(135deg, #4CAF50 0%, #2e7d32 100%);
            color: white;
        }

        .btn-warning {
            background: linear-gradient(135deg, #ff9800 0%, #f57c00 100%);
            color: white;
        }

        .btn-info {
            background: linear-gradient(135deg, #2196F3 0%, #1565c0 100%);
            color: white;
        }

        .btn-danger {
            background: linear-gradient(135deg, #f44336 0%, #c62828 100%);
            color: white;
        }

        .btn-secondary {
            background: linear-gradient(135deg, #757575 0%, #424242 100%);
            color: white;
        }

        /* === ØµÙØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© (Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø¹Ø§Ø¯ÙŠ) === */
        .user-info {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            padding: 25px;
            border-radius: 20px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
            display: flex;
            align-items: center;
            gap: 20px;
            flex-wrap: wrap;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        body.dark-mode .user-info {
            background: rgba(44, 44, 62, 0.95);
        }

        .user-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 36px;
            color: white;
        }

        .user-details {
            flex: 1;
        }

        .user-name {
            font-size: 1.5rem;
            font-weight: bold;
            color: #0d47a1;
            margin-bottom: 5px;
        }

        body.dark-mode .user-name {
            color: #8fa3f5;
        }

        .user-age {
            color: #666;
            font-size: 1.1rem;
        }

        body.dark-mode .user-age {
            color: #999;
        }

        .delete-user-btn {
            margin-right: auto;
        }

        /* === ØµÙØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© (Ù„Ù€ Admin) === */
        .admin-page .user-list {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        body.dark-mode .admin-page .user-list {
            background: rgba(44, 44, 62, 0.95);
        }

        .admin-user-card {
            background: rgba(249, 249, 249, 0.7);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 15px;
            border-right: 5px solid #667eea;
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 15px;
            backdrop-filter: blur(10px);
        }

        body.dark-mode .admin-user-card {
            background: rgba(26, 26, 46, 0.7);
        }

        .admin-user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .admin-user-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: white;
        }

        .admin-user-details h3 {
            color: #0d47a1;
            margin-bottom: 5px;
        }

        body.dark-mode .admin-user-details h3 {
            color: #8fa3f5;
        }

        .admin-user-stats {
            display: flex;
            gap: 15px;
            font-size: 14px;
            color: #666;
        }

        body.dark-mode .admin-user-stats {
            color: #999;
        }

        /* === Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£Ø¯ÙˆÙŠØ© === */
        .medications-list {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        body.dark-mode .medications-list {
            background: rgba(44, 44, 62, 0.95);
            color: #e0e0e0;
        }

        .section-title {
            font-size: 1.8rem;
            margin-bottom: 20px;
            color: #0d47a1;
            display: flex;
            align-items: center;
            gap: 10px;
            padding-bottom: 15px;
            border-bottom: 3px solid #667eea;
        }

        body.dark-mode .section-title {
            color: #8fa3f5;
        }

        .medication-card {
            background: rgba(249, 249, 249, 0.7);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 15px;
            border-right: 5px solid #667eea;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        body.dark-mode .medication-card {
            background: rgba(26, 26, 46, 0.7);
        }

        .medication-card:hover {
            transform: translateX(-5px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .medication-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .medication-name-wrapper {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .medication-name {
            font-size: 1.4rem;
            font-weight: bold;
            color: #0d47a1;
        }

        body.dark-mode .medication-name {
            color: #8fa3f5;
        }

        .medication-type {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
        }

        .type-pill {
            background: #e1f5fe;
            color: #0277bd;
        }

        .type-syrup {
            background: #f3e5f5;
            color: #6a1b9a;
        }

        .type-drops {
            background: #e8f5e9;
            color: #2e7d32;
        }

        .type-injection {
            background: #fff3e0;
            color: #e65100;
        }

        .type-cream {
            background: #fce4ec;
            color: #c2185b;
        }

        .type-inhaler {
            background: #e0f2f1;
            color: #00695c;
        }

        .type-capsule {
            background: #fff9c4;
            color: #f57f17;
        }

        .type-other {
            background: #f5f5f5;
            color: #616161;
        }

        .medication-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin-bottom: 15px;
        }

        .info-item {
            display: flex;
            align-items: center;
            gap: 8px;
            color: #666;
        }

        body.dark-mode .info-item {
            color: #999;
        }

        .info-item i {
            color: #667eea;
            width: 20px;
        }

        .medication-actions {
            display: flex;
            gap: 10px;
        }

        .medication-actions .btn {
            padding: 8px 15px;
            font-size: 14px;
        }

        /* === Ø§Ù„Ù†ÙˆØ§ÙØ° Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© === */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            padding: 40px;
            border-radius: 20px;
            max-width: 700px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        }

        body.dark-mode .modal-content {
            background: #2c2c3e;
            color: #e0e0e0;
        }

        .modal-header {
            font-size: 2rem;
            margin-bottom: 30px;
            color: #0d47a1;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        body.dark-mode .modal-header {
            color: #8fa3f5;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #0d47a1;
        }

        body.dark-mode .form-label {
            color: #8fa3f5;
        }

        .form-input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        body.dark-mode .form-input {
            background: #1a1a2e;
            color: #e0e0e0;
            border-color: #424242;
        }

        .form-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.2);
        }

        textarea.form-input {
            min-height: 100px;
            resize: vertical;
        }

        .modal-actions {
            display: flex;
            gap: 15px;
            margin-top: 30px;
        }

        .modal-actions .btn {
            flex: 1;
            justify-content: center;
        }

        /* === Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª === */
        .notification {
            position: fixed;
            top: 30px;
            left: 30px;
            padding: 20px 30px;
            background: #4CAF50;
            color: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            z-index: 3000;
            display: flex;
            align-items: center;
            gap: 15px;
            font-size: 1.1rem;
            font-weight: 600;
            transform: translateX(-150%);
            transition: transform 0.5s ease;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.error {
            background: #f44336;
        }

        .notification i {
            font-size: 1.5rem;
        }

        /* === Ø§Ù„Ø­Ø§Ù„Ø§Øª Ø§Ù„ÙØ§Ø±ØºØ© === */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #999;
        }

        .empty-state i {
            font-size: 4rem;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        body.dark-mode .empty-state {
            color: #999;
        }

        /* === Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ…Ø±ÙŠØ± === */
        ::-webkit-scrollbar {
            width: 10px;
            height: 10px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }

        body.dark-mode ::-webkit-scrollbar-track {
            background: #1a1a2e;
        }

        ::-webkit-scrollbar-thumb {
            background: #667eea;
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #764ba2;
        }

        /* === ØªØ­Ø³ÙŠÙ†Ø§Øª Ù„Ù„Ø¬ÙˆØ§Ù„ === */
        @media (max-width: 768px) {
            .language-switcher {
                top: 10px;
                left: 10px;
                flex-direction: column;
            }
            
            .lang-btn {
                padding: 8px 16px;
                font-size: 14px;
            }
            
            h1 {
                font-size: 1.8rem;
            }

            .header {
                padding: 20px;
            }

            .main-controls {
                flex-direction: column;
                padding: 20px;
            }

            .btn {
                width: 100%;
            }

            .user-info {
                flex-direction: column;
                text-align: center;
                padding: 20px;
            }

            .delete-user-btn {
                margin: 10px auto 0;
            }

            .medication-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }

            .medication-actions {
                width: 100%;
                justify-content: center;
            }

            .modal-content {
                padding: 20px;
            }
        }

        /* === ØªØ­Ø³ÙŠÙ†Ø§Øª Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© === */
        @media print {
            body {
                background: white !important;
                padding: 0 !important;
                color: black !important;
            }

            .no-print {
                display: none !important;
            }

            .login-page,
            .user-controls,
            .main-controls,
            .medication-actions .btn:not(.print-btn),
            .modal,
            .notification {
                display: none !important;
            }

            .container {
                max-width: 100% !important;
                margin: 0 !important;
                padding: 0 !important;
            }

            .header,
            .medications-list,
            .schedule-table-container {
                box-shadow: none !important;
                border: 1px solid #ddd !important;
                margin: 10px 0 !important;
                padding: 15px !important;
                border-radius: 0 !important;
                page-break-inside: avoid;
            }

            .btn {
                display: none !important;
            }

            .theme-toggle,
            .logout-btn {
                display: none !important;
            }
        }

        /* === Ø¥Ø¶Ø§ÙØ© Ø£Ù†Ù…Ø§Ø· Ù†Ø¸Ø§Ù… Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª === */
        .notifications-panel {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            padding: 25px;
            border-radius: 20px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        body.dark-mode .notifications-panel {
            background: rgba(44, 44, 62, 0.95);
            color: #e0e0e0;
        }

        .notification-settings {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .setting-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: rgba(249, 249, 249, 0.7);
            border-radius: 12px;
            border-right: 4px solid #667eea;
            backdrop-filter: blur(10px);
        }

        body.dark-mode .setting-item {
            background: rgba(26, 26, 46, 0.7);
        }

        .setting-info {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .setting-title {
            font-weight: 600;
            color: #0d47a1;
        }

        body.dark-mode .setting-title {
            color: #8fa3f5;
        }

        .setting-desc {
            font-size: 0.9rem;
            color: #666;
        }

        body.dark-mode .setting-desc {
            color: #999;
        }

        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 30px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 34px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 22px;
            width: 22px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background: linear-gradient(135deg, #4CAF50 0%, #2e7d32 100%);
        }

        input:checked + .slider:before {
            transform: translateX(30px);
        }

        .test-notification-btn {
            margin-top: 10px;
            background: #9c27b0;
            color: white;
        }

        .test-notification-btn:hover {
            background: #7b1fa2;
        }

        .floating-notifications-btn {
            position: fixed;
            bottom: 30px;
            left: 30px;
            z-index: 1000;
            background: linear-gradient(135deg, #ff9800 0%, #f57c00 100%);
            color: white;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            border: none;
            cursor: pointer;
            font-size: 24px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .floating-notifications-btn:hover {
            transform: scale(1.1);
        }

        .floating-notifications-btn.active {
            background: linear-gradient(135deg, #4CAF50 0%, #2e7d32 100%);
        }

        .floating-notifications-btn.muted {
            background: linear-gradient(135deg, #f44336 0%, #c62828 100%);
        }

        .medication-alert-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.8);
            z-index: 9999;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s ease;
        }

        .medication-alert {
            background: white;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
            max-width: 500px;
            width: 90%;
            text-align: center;
            animation: slideUp 0.5s ease;
            border: 5px solid #ff9800;
        }

        body.dark-mode .medication-alert {
            background: #2c2c3e;
            color: #e0e0e0;
        }

        .alert-header {
            margin-bottom: 20px;
        }

        .alert-header h3 {
            color: #ff9800;
            font-size: 1.8rem;
            margin: 10px 0;
        }

        .alert-body {
            background: #f9f9f9;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 25px;
            text-align: right;
        }

        body.dark-mode .alert-body {
            background: #1a1a2e;
        }

        .alert-body p {
            margin: 10px 0;
            font-size: 1.1rem;
        }

        .alert-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .alert-actions .btn {
            flex: 1;
            min-width: 150px;
            justify-content: center;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideUp {
            from { transform: translateY(50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .notification-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: #f44336;
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }
    </style>
</head>

<body>
    <!-- ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ù„ØºØ© -->
    <div class="language-switcher" id="languageSwitcher">
        <button class="lang-btn" onclick="Translator.setLanguage('ar')">
            <i class="fas fa-language"></i> Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©
        </button>
        <button class="lang-btn" onclick="Translator.setLanguage('en')">
            <i class="fas fa-language"></i> English
        </button>
    </div>

    <!-- ØµÙØ­Ø© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù†Ø¸Ø§Ù… (Ù„Ù„Ù…Ø¯ÙŠØ±) -->
    <div class="page admin-page" id="adminPage">
        <div class="container">
            <div class="header">
                <div class="user-controls">
                    <button class="theme-toggle" onclick="toggleTheme()">ğŸŒ™</button>
                    <button class="logout-btn" onclick="logout()">
                        <i class="fas fa-sign-out-alt"></i>
                    </button>
                </div>
                <h1 data-translate="adminDashboard"><i class="fas fa-user-shield"></i> Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ù…Ø¯ÙŠØ±</h1>
                <p class="subtitle" data-translate="manageUsers">Ø¥Ø¯Ø§Ø±Ø© Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</p>
                <div class="current-date" id="currentDate"></div>
            </div>

            <div class="user-list" id="adminUserList">
                <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¨Ø§Ù„ÙƒÙˆØ¯ -->
            </div>
        </div>
    </div>

    <!-- ØµÙØ­Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© -->
    <div class="page user-page" id="userPage">
        <div class="container">
            <div class="header">
                <div class="user-controls">
                    <button class="theme-toggle" onclick="toggleTheme()">ğŸŒ™</button>
                    <button class="logout-btn" onclick="logout()">
                        <i class="fas fa-sign-out-alt"></i>
                    </button>
                </div>
                <h1 data-translate="appTitle"><i class="fas fa-pills"></i> Ù†Ø¸Ø§Ù… Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ø£Ø¯ÙˆÙŠØ© Ø§Ù„Ù…ØªÙ‚Ø¯Ù…</h1>
                <p class="subtitle" data-translate="appSubtitle">Ø¥Ø¯Ø§Ø±Ø© Ø£Ø¯ÙˆÙŠØªÙƒ ÙˆÙ…ØªØ§Ø¨Ø¹Ø© Ø¬Ø±Ø¹Ø§ØªÙƒ Ø¨Ø¯Ù‚Ø©</p>
                <div class="current-date" id="currentDate"></div>
            </div>

            <div class="user-info" id="userInfo">
                <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¨Ø§Ù„ÙƒÙˆØ¯ -->
            </div>

            <!-- Ù„ÙˆØ­Ø© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª -->
            <div class="notifications-panel" id="notificationsPanel">
                <h2 class="section-title">
                    <i class="fas fa-bell"></i> <span data-translate="notificationManagement">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª ÙˆØ§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª</span>
                </h2>
                
                <div class="notification-settings">
                    <div class="setting-item">
                        <div class="setting-info">
                            <span class="setting-title" data-translate="pushNotifications">Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Push</span>
                            <span class="setting-desc" data-translate="pushNotificationsDesc">Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø¹Ù„Ù‰ Ø´Ø§Ø´Ø© Ù‡Ø§ØªÙÙƒ Ø­ØªÙ‰ Ø¹Ù†Ø¯ Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù…ÙˆÙ‚Ø¹</span>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="pushNotificationsToggle" onclick="togglePushNotifications()">
                            <span class="slider"></span>
                        </label>
                    </div>
                    
                    <div class="setting-item">
                        <div class="setting-info">
                            <span class="setting-title" data-translate="soundNotifications">Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø§Ù„ØµÙˆØªÙŠØ©</span>
                            <span class="setting-desc" data-translate="soundNotificationsDesc">ØªØ´ØºÙŠÙ„ ØµÙˆØª Ø¹Ù†Ø¯ ÙˆÙ‚Øª Ø§Ù„Ø¯ÙˆØ§Ø¡</span>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="soundNotificationsToggle" checked onclick="toggleSoundNotifications()">
                            <span class="slider"></span>
                        </label>
                    </div>
                    
                    <div class="setting-item">
                        <div class="setting-info">
                            <span class="setting-title" data-translate="autoRepeat">Ø§Ù„ØªÙƒØ±Ø§Ø± Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ</span>
                            <span class="setting-desc" data-translate="autoRepeatDesc">ØªÙƒØ±Ø§Ø± Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± ÙƒÙ„ 10 Ø¯Ù‚Ø§Ø¦Ù‚ Ø­ØªÙ‰ Ø£Ø®Ø° Ø§Ù„Ø¯ÙˆØ§Ø¡</span>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="autoRepeatToggle" checked onclick="toggleAutoRepeat()">
                            <span class="slider"></span>
                        </label>
                    </div>
                    
                    <div class="setting-item">
                        <div class="setting-info">
                            <span class="setting-title" data-translate="muteMode">ÙˆØ¶Ø¹ Ø§Ù„ØµØ§Ù…Øª</span>
                            <span class="setting-desc" data-translate="muteModeDesc">ÙƒØªÙ… Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ù„Ù…Ø¯Ø© 10 Ø¯Ù‚Ø§Ø¦Ù‚ Ø¹Ù†Ø¯ Ø§Ù„Ø·Ù„Ø¨</span>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="muteToggle" onclick="toggleMute()">
                            <span class="slider"></span>
                        </label>
                    </div>
                    
                    <button class="btn test-notification-btn" onclick="testNotification()" data-translate="testNotification">
                        <i class="fas fa-bell"></i> Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
                    </button>
                </div>
            </div>

            <div class="main-controls">
                <button class="btn btn-primary" onclick="openAddMedicationModal()" data-translate="addMedication">
                    <i class="fas fa-plus"></i> Ø¥Ø¶Ø§ÙØ© Ø¯ÙˆØ§Ø¡ Ø¬Ø¯ÙŠØ¯
                </button>
                <button class="btn btn-info" onclick="openSchedulePage()" data-translate="viewSchedule">
                    <i class="fas fa-calendar-alt"></i> Ø¹Ø±Ø¶ Ø§Ù„Ø¬Ø¯ÙˆÙ„ ÙˆØ§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
                </button>
                <button class="btn btn-warning" onclick="printSchedule()" data-translate="printSchedule">
                    <i class="fas fa-print"></i> Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ø¬Ø¯ÙˆÙ„
                </button>
            </div>

            <div class="medications-list">
                <h2 class="section-title">
                    <i class="fas fa-list"></i> <span data-translate="medicationList">Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£Ø¯ÙˆÙŠØ©</span>
                </h2>
                <div id="medicationsList"></div>
            </div>
        </div>
    </div>

    <!-- Ø²Ø± Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„Ø¹Ø§Ø¦Ù… -->
    <button class="floating-notifications-btn" id="floatingNotificationsBtn" onclick="showMedicationAlert()">
        <i class="fas fa-bell"></i>
    </button>

    <!-- Ù†Ø§ÙØ°Ø© Ø¥Ø¶Ø§ÙØ©/ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¯ÙˆØ§Ø¡ -->
    <div class="modal" id="medicationModal">
        <div class="modal-content">
            <div class="modal-header" id="modalTitle">
                <i class="fas fa-plus-circle"></i> Ø¥Ø¶Ø§ÙØ© Ø¯ÙˆØ§Ø¡ Ø¬Ø¯ÙŠØ¯
            </div>
            
            <div class="form-group">
                <label class="form-label" data-translate="medicationName">Ø§Ø³Ù… Ø§Ù„Ø¯ÙˆØ§Ø¡</label>
                <input type="text" class="form-input" id="medName" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ø¯ÙˆØ§Ø¡">
            </div>
            
            <div class="form-group">
                <label class="form-label" data-translate="medicationType">Ù†ÙˆØ¹ Ø§Ù„Ø¯ÙˆØ§Ø¡</label>
                <select class="form-input" id="medType">
                    <option value="pill" data-translate="pill">Ø­Ø¨ÙˆØ¨</option>
                    <option value="capsule" data-translate="capsule">ÙƒØ¨Ø³ÙˆÙ„Ø§Øª</option>
                    <option value="syrup" data-translate="syrup">Ø´Ø±Ø§Ø¨</option>
                    <option value="drops" data-translate="drops">Ù‚Ø·Ø±Ø©</option>
                    <option value="injection" data-translate="injection">Ø­Ù‚Ù†</option>
                    <option value="cream" data-translate="cream">ÙƒØ±ÙŠÙ…</option>
                    <option value="inhaler" data-translate="inhaler">Ø¨Ø®Ø§Ø®</option>
                    <option value="other" data-translate="other">Ø£Ø®Ø±Ù‰</option>
                </select>
            </div>
            
            <div class="form-group">
                <label class="form-label" data-translate="dosage">Ø§Ù„Ø¬Ø±Ø¹Ø©</label>
                <input type="text" class="form-input" id="medDosage" placeholder="Ù…Ø«Ø§Ù„: Ø­Ø¨Ø© ÙˆØ§Ø­Ø¯Ø©ØŒ Ù…Ù„Ø¹Ù‚Ø© ØµØºÙŠØ±Ø©" data-translate-placeholder="dosagePlaceholder">
            </div>
            
            <div class="form-group">
                <label class="form-label" data-translate="startDate">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø¡</label>
                <input type="date" class="form-input" id="medStartDate">
            </div>
            
            <div class="form-group">
                <label class="form-label" data-translate="startTime">ÙˆÙ‚Øª Ø§Ù„Ø¬Ø±Ø¹Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰</label>
                <input type="time" class="form-input" id="medStartTime">
            </div>
            
            <div class="form-group">
                <label class="form-label" data-translate="duration">Ø§Ù„Ù…Ø¯Ø© (Ø£ÙŠØ§Ù…)</label>
                <input type="number" class="form-input" id="medDuration" min="1" max="365" value="7">
            </div>
            
            <div class="form-group">
                <label class="form-label" data-translate="frequency">Ø¹Ø¯Ø¯ Ø§Ù„Ø¬Ø±Ø¹Ø§Øª Ø§Ù„ÙŠÙˆÙ…ÙŠØ©</label>
                <select class="form-input" id="medFrequency">
                    <option value="1">1 Ù…Ø±Ø© ÙŠÙˆÙ…ÙŠØ§Ù‹</option>
                    <option value="2">2 Ù…Ø±Ø§Øª ÙŠÙˆÙ…ÙŠØ§Ù‹</option>
                    <option value="3" selected>3 Ù…Ø±Ø§Øª ÙŠÙˆÙ…ÙŠØ§Ù‹</option>
                    <option value="4">4 Ù…Ø±Ø§Øª ÙŠÙˆÙ…ÙŠØ§Ù‹</option>
                    <option value="5">5 Ù…Ø±Ø§Øª ÙŠÙˆÙ…ÙŠØ§Ù‹</option>
                    <option value="6">6 Ù…Ø±Ø§Øª ÙŠÙˆÙ…ÙŠØ§Ù‹</option>
                </select>
            </div>
            
            <div class="form-group">
                <label class="form-label" data-translate="foodRelation">Ø§Ù„Ø¹Ù„Ø§Ù‚Ø© Ø¨Ø§Ù„Ø·Ø¹Ø§Ù…</label>
                <select class="form-input" id="medFoodRelation">
                    <option value="before" data-translate="beforeMeal">Ù‚Ø¨Ù„ Ø§Ù„Ø£ÙƒÙ„</option>
                    <option value="after" data-translate="afterMeal">Ø¨Ø¹Ø¯ Ø§Ù„Ø£ÙƒÙ„</option>
                    <option value="none" data-translate="none">Ù„Ø§ Ø¹Ù„Ø§Ù‚Ø© Ø¨Ø§Ù„Ø·Ø¹Ø§Ù…</option>
                </select>
            </div>
            
            <div class="modal-actions">
                <button class="btn btn-primary" onclick="saveMedication()" data-translate="save">Ø­ÙØ¸</button>
                <button class="btn btn-secondary" onclick="closeModal('medicationModal')" data-translate="cancel">Ø¥Ù„ØºØ§Ø¡</button>
            </div>
        </div>
    </div>

    <!-- Ù†Ø§ÙØ°Ø© ØªÙ†Ø¨ÙŠÙ‡ Ø§Ù„Ø¯ÙˆØ§Ø¡ -->
    <div class="medication-alert-overlay" id="medicationAlert" style="display: none;">
        <div class="medication-alert">
            <div class="alert-header">
                <i class="fas fa-bell fa-3x" style="color: #ff9800;"></i>
                <h3 data-translate="timeForMedication">â° ÙˆÙ‚Øª Ø§Ù„Ø¯ÙˆØ§Ø¡!</h3>
            </div>
            <div class="alert-body">
                <p><strong id="alertMedName">Ø§Ø³Ù… Ø§Ù„Ø¯ÙˆØ§Ø¡</strong></p>
                <p><strong data-translate="time">Ø§Ù„ÙˆÙ‚Øª:</strong> <span id="alertMedTime"></span></p>
                <p><strong data-translate="dosage">Ø§Ù„Ø¬Ø±Ø¹Ø©:</strong> <span id="alertMedDose"></span></p>
            </div>
            <div class="alert-actions">
                <button class="btn btn-success" onclick="takeMedication()" data-translate="takeMedication">
                    <i class="fas fa-check"></i> ØªÙ… ØªÙ†Ø§ÙˆÙ„ Ø§Ù„Ø¯ÙˆØ§Ø¡
                </button>
                <button class="btn btn-warning" onclick="snoozeMedication()" data-translate="snooze">
                    <i class="fas fa-clock"></i> ØªØ£Ø¬ÙŠÙ„ 10 Ø¯Ù‚Ø§Ø¦Ù‚
                </button>
                <button class="btn btn-danger" onclick="closeAlert()" data-translate="close">
                    <i class="fas fa-times"></i> Ø¥ØºÙ„Ø§Ù‚
                </button>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-messaging.js"></script>
    
    <!-- Ù…ÙƒØªØ¨Ø§Øª Ù…Ø³Ø§Ø¹Ø¯Ø© -->
    <script src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
    
    <!-- Ù…Ù„ÙØ§Øª Ø§Ù„Ù†Ø¸Ø§Ù… -->
    <script src="translation.js"></script>
    <script src="firebase-db.js"></script>
    <script src="app.js"></script>

<script>
    // ===== ØªÙƒÙˆÙŠÙ† Firebase =====
    const firebaseConfig = {
        apiKey: "AIzaSyBAcSevspk9_fK4jC1ZkLRhRMNqG9Pv5mU",
        authDomain: "medicine-tracker-a8955.firebaseapp.com",
        databaseURL: "https://medicine-tracker-a8955-default-rtdb.firebaseio.com",
        projectId: "medicine-tracker-a8955",
        storageBucket: "medicine-tracker-a8955.firebasestorage.app",
        messagingSenderId: "507688371470",
        appId: "1:507688371470:web:e65375310a82e5ba83435f",
        measurementId: "G-SK8M4BFT6Q"
    };

    // ===== ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù†Ø¸Ø§Ù… =====
    let db;
    let currentUser = null;

    document.addEventListener('DOMContentLoaded', async function() {
        // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ±Ø¬Ù…Ø©
        Translator.init();
        
        // ØªÙ‡ÙŠØ¦Ø© Firebase
        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }
        
        // ØªÙ‡ÙŠØ¦Ø© Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        db = new FirebaseDB();
        
        // Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø¬Ù„Ø³Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
        await restoreSession();
        
        // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØµÙØ­Ø©
        initPage();
        
        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        loadData();
    });

    // ===== Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¬Ù„Ø³Ø© =====
    async function restoreSession() {
        try {
            const userStr = localStorage.getItem('currentUser');
            if (!userStr) {
                window.location.href = 'login.html';
                return;
            }
            
            currentUser = JSON.parse(userStr);
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµØ­Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
            if (currentUser.id === 'admin') {
                showAdminPage();
                return;
            }
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            const userData = await db.getUser(currentUser.id);
            if (!userData) {
                localStorage.removeItem('currentUser');
                window.location.href = 'login.html';
                return;
            }
            
            showUserPage();
        } catch (error) {
            console.error('Error restoring session:', error);
            localStorage.removeItem('currentUser');
            window.location.href = 'login.html';
        }
    }

    function initPage() {
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªØ§Ø±ÙŠØ®
        updateCurrentDate();
        setInterval(updateCurrentDate, 60000);
        
        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø³Ù…Ø©
        loadTheme();
    }

    function updateCurrentDate() {
        const now = new Date();
        const options = { 
            weekday: 'long', 
            year: 'numeric', 
            month: 'long', 
            day: 'numeric' 
        };
        
        const dateElements = document.querySelectorAll('#currentDate');
        dateElements.forEach(element => {
            element.textContent = now.toLocaleDateString(
                Translator.currentLang === 'ar' ? 'ar-SA' : 'en-US', 
                options
            );
        });
    }

    function loadTheme() {
        const theme = localStorage.getItem('theme') || 'light';
        if (theme === 'dark') {
            document.body.classList.add('dark-mode');
            const themeButtons = document.querySelectorAll('.theme-toggle');
            themeButtons.forEach(btn => {
                btn.innerHTML = '<i class="fas fa-sun"></i>';
            });
        }
    }

    function toggleTheme() {
        document.body.classList.toggle('dark-mode');
        const theme = document.body.classList.contains('dark-mode') ? 'dark' : 'light';
        localStorage.setItem('theme', theme);
        
        const themeButtons = document.querySelectorAll('.theme-toggle');
        themeButtons.forEach(btn => {
            btn.innerHTML = theme === 'dark' ? '<i class="fas fa-sun"></i>' : '<i class="fas fa-moon"></i>';
        });
    }

    // ===== Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØµÙØ­Ø§Øª =====
    function showAdminPage() {
        document.getElementById('adminPage').classList.add('active');
        document.getElementById('userPage').classList.remove('active');
    }

    function showUserPage() {
        document.getElementById('adminPage').classList.remove('active');
        document.getElementById('userPage').classList.add('active');
    }

    // ===== ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª =====
    async function loadData() {
        if (!currentUser) return;
        
        try {
            if (currentUser.id === 'admin') {
                await loadAdminData();
            } else {
                await loadUserData();
            }
        } catch (error) {
            console.error('Error loading data:', error);
            showToast(Translator.translate('loadError'), 'error');
        }
    }

    async function loadAdminData() {
        try {
            const users = await db.getAllUsers();
            renderAdminUserList(users);
        } catch (error) {
            console.error('Error loading admin data:', error);
        }
    }

    async function loadUserData() {
        try {
            const medications = await db.getUserMedications(currentUser.id);
            renderUserMedications(medications);
            renderUserInfo();
            
            // Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ù„Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª ÙÙŠ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ
            db.listenToMedications(currentUser.id, (medications) => {
                renderUserMedications(medications);
            });
        } catch (error) {
            console.error('Error loading user data:', error);
        }
    }

    // ===== Ø¹Ø±Ø¶ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª =====
    function renderUserInfo() {
        if (!currentUser) return;
        
        const userInfoDiv = document.getElementById('userInfo');
        if (!userInfoDiv) return;
        
        userInfoDiv.innerHTML = `
            <div class="user-avatar">
                <i class="fas fa-user"></i>
            </div>
            <div class="user-details">
                <div class="user-name">${currentUser.name}</div>
                <div class="user-age">${currentUser.age ? Translator.translate('age') + ': ' + currentUser.age : ''}</div>
            </div>
            ${currentUser.id !== 'admin' ? `
                <button class="btn btn-danger delete-user-btn" onclick="deleteUserAccount()">
                    <i class="fas fa-trash"></i> ${Translator.translate('deleteAccount')}
                </button>
            ` : ''}
        `;
    }

    function renderUserMedications(medications) {
        const container = document.getElementById('medicationsList');
        if (!container) return;

        if (!medications || medications.length === 0) {
            container.innerHTML = `
                <div class="empty-state">
                    <i class="fas fa-inbox"></i>
                    <p>${Translator.translate('noMedications')}</p>
                </div>
            `;
            return;
        }

        container.innerHTML = medications.map(med => {
            const totalDoses = med.doses ? med.doses.length : 0;
            const takenDoses = med.doses ? med.doses.filter(d => d.taken).length : 0;
            const adherence = totalDoses > 0 ? Math.round((takenDoses / totalDoses) * 100) : 0;

            const foodText = {
                'before': Translator.translate('beforeMeal'),
                'after': Translator.translate('afterMeal'),
                'none': Translator.translate('none')
            };

            return `
                <div class="medication-card">
                    <div class="medication-header">
                        <div class="medication-name-wrapper">
                            <span class="medication-name">${med.name}</span>
                            <span class="medication-type type-${med.type}">
                                ${Translator.translate(med.type)}
                            </span>
                        </div>
                        <div class="medication-actions">
                            <button class="btn btn-info" onclick="openEditMedicationModal('${med.id}')">
                                <i class="fas fa-edit"></i> ${Translator.translate('edit')}
                            </button>
                            <button class="btn btn-danger" onclick="deleteMedication('${med.id}')">
                                <i class="fas fa-trash"></i> ${Translator.translate('delete')}
                            </button>
                        </div>
                    </div>
                    <div class="medication-info">
                        <div class="info-item">
                            <i class="fas fa-calendar-alt"></i>
                            <span>${Translator.translate('startDate')}: ${med.startDate}</span>
                        </div>
                        <div class="info-item">
                            <i class="fas fa-clock"></i>
                            <span>${Translator.translate('firstDose')}: ${formatTimeTo12Hour(med.startTime)}</span>
                        </div>
                        <div class="info-item">
                            <i class="fas fa-hourglass-half"></i>
                            <span>${Translator.translate('duration')}: ${med.duration} ${Translator.translate('days')}</span>
                        </div>
                        <div class="info-item">
                            <i class="fas fa-redo"></i>
                            <span>${med.frequency} ${Translator.translate('timesPerDay')}</span>
                        </div>
                        <div class="info-item">
                            <i class="fas fa-utensils"></i>
                            <span>${foodText[med.foodRelation]}</span>
                        </div>
                        <div class="info-item">
                            <i class="fas fa-prescription-bottle-alt"></i>
                            <span>${Translator.translate('dosage')}: ${med.dosage || Translator.translate('notSpecified')}</span>
                        </div>
                        <div class="info-item">
                            <i class="fas fa-chart-line"></i>
                            <span>${Translator.translate('adherence')}: ${adherence}%</span>
                        </div>
                    </div>
                </div>
            `;
        }).join('');
    }

    function renderAdminUserList(users) {
        const container = document.getElementById('adminUserList');
        if (!container) return;

        // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… admin Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
        const filteredUsers = Object.entries(users).filter(([key]) => key !== 'admin');

        if (filteredUsers.length === 0) {
            container.innerHTML = `
                <div class="empty-state">
                    <i class="fas fa-users"></i>
                    <p>${Translator.translate('noUsers')}</p>
                </div>
            `;
            return;
        }

        container.innerHTML = filteredUsers.map(([username, user]) => {
            return `
                <div class="admin-user-card">
                    <div class="admin-user-info">
                        <div class="admin-user-avatar">
                            <i class="fas fa-user"></i>
                        </div>
                        <div class="admin-user-details">
                            <h3>${user.name}</h3>
                            <div>${Translator.translate('username')}: ${username}</div>
                            ${user.age ? `<div>${Translator.translate('age')}: ${user.age}</div>` : ''}
                        </div>
                    </div>
                    <button class="btn btn-danger" onclick="adminDeleteUser('${username}')">
                        <i class="fas fa-trash"></i> ${Translator.translate('delete')}
                    </button>
                </div>
            `;
        }).join('');
    }

    // ===== Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø¯ÙˆÙŠØ© =====
    let editingMedicationId = null;

    function openAddMedicationModal() {
        if (!currentUser || currentUser.id === 'admin') return;
        
        editingMedicationId = null;
        document.getElementById('modalTitle').innerHTML = 
            `<i class="fas fa-plus-circle"></i> ${Translator.translate('addMedication')}`;
        
        document.getElementById('medName').value = '';
        document.getElementById('medType').value = 'pill';
        document.getElementById('medDosage').value = '';
        
        const today = new Date();
        const defaultDate = today.toISOString().split('T')[0];
        document.getElementById('medStartDate').value = defaultDate;
        
        const defaultTime = new Date(today.getTime() + 5 * 60000);
        const hours = defaultTime.getHours().toString().padStart(2, '0');
        const minutes = defaultTime.getMinutes().toString().padStart(2, '0');
        document.getElementById('medStartTime').value = `${hours}:${minutes}`;
        
        document.getElementById('medDuration').value = '7';
        document.getElementById('medFrequency').value = '3';
        document.getElementById('medFoodRelation').value = 'before';
        
        document.getElementById('medicationModal').classList.add('active');
    }

    async function saveMedication() {
        if (!currentUser || currentUser.id === 'admin') return;

        const username = currentUser.id;
        const name = document.getElementById('medName').value.trim();
        const type = document.getElementById('medType').value;
        const dosage = document.getElementById('medDosage').value.trim();
        const startDate = document.getElementById('medStartDate').value;
        const startTime = document.getElementById('medStartTime').value;
        const duration = parseInt(document.getElementById('medDuration').value);
        const frequency = parseInt(document.getElementById('medFrequency').value);
        const foodRelation = document.getElementById('medFoodRelation').value;

        if (!name || !startDate || !startTime || !duration || !frequency) {
            showToast(Translator.translate('fillAllFields'), 'error');
            return;
        }

        try {
            if (editingMedicationId) {
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¯ÙˆØ§Ø¡
                const medication = {
                    name: name,
                    type: type,
                    dosage: dosage,
                    startDate: startDate,
                    startTime: startTime,
                    duration: duration,
                    frequency: frequency,
                    foodRelation: foodRelation
                };
                
                await db.updateMedication(username, editingMedicationId, medication);
                showToast(Translator.translate('medicationUpdated'), 'success');
            } else {
                // Ø¥Ø¶Ø§ÙØ© Ø¯ÙˆØ§Ø¡ Ø¬Ø¯ÙŠØ¯
                const medication = {
                    name: name,
                    type: type,
                    dosage: dosage,
                    startDate: startDate,
                    startTime: startTime,
                    duration: duration,
                    frequency: frequency,
                    foodRelation: foodRelation,
                    doses: generateDosesForMedication(startDate, startTime, duration, frequency),
                    createdAt: new Date().toISOString()
                };

                await db.saveMedication(username, medication);
                showToast(Translator.translate('medicationAdded'), 'success');
            }

            closeModal('medicationModal');
            
            // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            await loadData();
        } catch (error) {
            console.error('Error saving medication:', error);
            showToast(Translator.translate('saveError'), 'error');
        }
    }

    function generateDosesForMedication(startDate, startTime, duration, frequency) {
        const doses = [];
        const [startHour, startMinute] = startTime.split(':').map(Number);
        const startDateTime = new Date(startDate + 'T' + startTime + ':00');
        const intervalHours = 24 / frequency;

        for (let day = 0; day < duration; day++) {
            for (let i = 0; i < frequency; i++) {
                const doseDateTime = new Date(startDateTime);
                doseDateTime.setHours(startDateTime.getHours() + (day * 24) + (i * intervalHours));

                doses.push({
                    id: 'dose-' + Date.now() + '-' + Math.random().toString(36).substr(2, 9),
                    dateTime: doseDateTime.toISOString(),
                    taken: false,
                    takenTime: null,
                    note: ''
                });
            }
        }

        doses.sort((a, b) => new Date(a.dateTime) - new Date(b.dateTime));
        return doses;
    }

    async function deleteMedication(medicationId) {
        if (!currentUser || !medicationId) return;
        
        if (!confirm(Translator.translate('deleteConfirmation'))) return;
        
        try {
            await db.deleteMedication(currentUser.id, medicationId);
            showToast(Translator.translate('medicationDeleted'), 'success');
            await loadData();
        } catch (error) {
            console.error('Error deleting medication:', error);
            showToast(Translator.translate('deleteError'), 'error');
        }
    }

    async function openEditMedicationModal(medicationId) {
        if (!currentUser || currentUser.id === 'admin') return;
        
        editingMedicationId = medicationId;
        
        try {
            const medications = await db.getUserMedications(currentUser.id);
            const med = medications.find(m => m.id === medicationId);
            
            if (!med) return;

            document.getElementById('modalTitle').innerHTML = 
                `<i class="fas fa-edit"></i> ${Translator.translate('editMedication')}`;
            
            document.getElementById('medName').value = med.name;
            document.getElementById('medType').value = med.type;
            document.getElementById('medDosage').value = med.dosage || '';
            document.getElementById('medStartDate').value = med.startDate;
            document.getElementById('medStartTime').value = med.startTime;
            document.getElementById('medDuration').value = med.duration;
            document.getElementById('medFrequency').value = med.frequency;
            document.getElementById('medFoodRelation').value = med.foodRelation;

            document.getElementById('medicationModal').classList.add('active');
        } catch (error) {
            console.error('Error loading medication for edit:', error);
            showToast(Translator.translate('loadError'), 'error');
        }
    }

    // ===== Ø¯ÙˆØ§Ù„ Ù…Ø³Ø§Ø¹Ø¯Ø© =====
    function formatTimeTo12Hour(timeStr) {
        if (!timeStr) return '';
        
        const [hours, minutes] = timeStr.split(':').map(Number);
        const ampm = hours >= 12 ? 'Ù…' : 'Øµ';
        let hours12 = hours % 12;
        hours12 = hours12 ? hours12 : 12;
        return `${hours12}:${minutes.toString().padStart(2, '0')} ${ampm}`;
    }

    function showToast(message, type = 'success') {
        Toastify({
            text: message,
            duration: 3000,
            gravity: "top",
            position: Translator.currentLang === 'ar' ? "left" : "right",
            backgroundColor: type === 'success' ? "#4CAF50" : "#f44336",
            stopOnFocus: true
        }).showToast();
    }

    function closeModal(modalId) {
        document.getElementById(modalId).classList.remove('active');
        editingMedicationId = null;
    }

    function logout() {
        localStorage.removeItem('currentUser');
        window.location.href = 'login.html';
    }

    function openSchedulePage() {
        if (!currentUser) return;
        
        window.open('schedule.html?user=' + encodeURIComponent(currentUser.id), '_blank');
    }

    function printSchedule() {
        if (!currentUser) return;
        
        const printWindow = window.open('schedule.html?user=' + encodeURIComponent(currentUser.id) + '&print=true', '_blank');
        
        setTimeout(() => {
            if (printWindow) {
                printWindow.onload = function() {
                    printWindow.print();
                };
            }
        }, 1000);
    }

    // ===== Ø¯ÙˆØ§Ù„ Ù…ØªØ§Ø­Ø© Ø¹Ø§Ù„Ù…ÙŠØ§Ù‹ =====
    window.toggleTheme = toggleTheme;
    window.logout = logout;
    window.openAddMedicationModal = openAddMedicationModal;
    window.saveMedication = saveMedication;
    window.deleteMedication = deleteMedication;
    window.closeModal = closeModal;
    window.openEditMedicationModal = openEditMedicationModal;
    window.openSchedulePage = openSchedulePage;
    window.printSchedule = printSchedule;
</script>
</body>
</html>